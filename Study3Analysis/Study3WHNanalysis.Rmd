---
title: "Study3WHNAnalysis"
author: "TGoodge"
date: '2023-03-24'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(splitstackshape)
library(stringr)
library(data.table)
library(dplyr)
library(tidyr)
library(gridExtra)
library(lme4)
library(lmerTest)
library(ggplot2)
library(ggthemes)
library(report)

```

####Data Wrangling

```{r}
dataFolder = "C:/Users/thoma/OneDrive - University of Glasgow/Desktop/Study3/data/PsychoPy"

file_list <- list.files(path = dataFolder, pattern = "..csv$", all.files = TRUE, full.names = TRUE, recursive = TRUE) 
```

```{r}
RawWHNDataset <- data.frame()
#loop through all the fills, create a temporary container, remove the first, second and last rows and then add 1 to the trials counter. Then bind it to the dataset
for (file in file_list){
  tempData <- read.csv(file, header = T)  
    
  RawWHNDataset <- bind_rows(RawWHNDataset, tempData)
}

```

```{r}
SortedWHNDataset <- RawWHNDataset %>% 
  select(participant,image_file,Correct,trials_3.thisTrialN, conf_slider.response, conf_slider.rt, MiseryScale.response, Attention_slider.response, trialResp.keys, trialResp.corr)

SortedWHNDataset$Attention_slider.response <- as.numeric(SortedWHNDataset$Attention_slider.response)
```

```{r}
Counterbalancing <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Desktop/Study3/Study3Counterbalancing.csv", header = T)

Counterbalancing <- Counterbalancing%>%  select(participant, Second, Third, Fourth, Fifth)

Counterbalancing <- na.omit(Counterbalancing)
```


```{r}
OrderWHNDataset <- left_join(SortedWHNDataset, Counterbalancing, by = 'participant') 
OrderWHNDataset$Block <- 'Baseline' 


OrderWHNDataset$Block <-  if_else(OrderWHNDataset$trials_3.thisTrialN >= 32, OrderWHNDataset$Fifth, 
                                  if_else(OrderWHNDataset$trials_3.thisTrialN >= 24, OrderWHNDataset$Fourth,
                                          if_else(OrderWHNDataset$trials_3.thisTrialN >= 16, OrderWHNDataset$Third,
                                                  if_else(OrderWHNDataset$trials_3.thisTrialN >= 8, OrderWHNDataset$Second, 
                                                          'Baseline'))))


WHNDataset <- OrderWHNDataset
WHNDataset <- WHNDataset[!is.na(WHNDataset$Correct),]

```


```{r}

NoPpts <- n_distinct(WHNDataset$participant)

#WHNDataset <- WHNDataset %>% 
 # subset(image_file != "Slide24")

WHNDataset$participant <- as.factor(WHNDataset$participant)

WHNSummary <- WHNDataset %>% 
  group_by(Block) %>% 
  summarise(n = n()/NoPpts,
            WHN = sum(trialResp.corr) / NoPpts,
            WHNPercent = sum((trialResp.corr / NoPpts) /8) * 100,
            sdWHN = sd(trialResp.corr),
            meanConf = mean(conf_slider.response),
            sdConf = sd(conf_slider.response),
            meanMISC = mean(MiseryScale.response),
            sdMISC = sd(MiseryScale.response),
            meanAttention = mean(Attention_slider.response),
            sdAttention = sd(Attention_slider.response)
            )


WHNDataset$image_file[WHNDataset$image_file == "Slide1"] <- "Slide01"
WHNDataset$image_file[WHNDataset$image_file == "Slide2"] <- "Slide02"
WHNDataset$image_file[WHNDataset$image_file == "Slide3"] <- "Slide03"
WHNDataset$image_file[WHNDataset$image_file == "Slide4"] <- "Slide04"
WHNDataset$image_file[WHNDataset$image_file == "Slide5"] <- "Slide05"
WHNDataset$image_file[WHNDataset$image_file == "Slide6"] <- "Slide06"
WHNDataset$image_file[WHNDataset$image_file == "Slide7"] <- "Slide07"
WHNDataset$image_file[WHNDataset$image_file == "Slide8"] <- "Slide08"
WHNDataset$image_file[WHNDataset$image_file == "Slide9"] <- "Slide09"

WHNSummary$Block[WHNSummary$Block == "GemsBasic"] <- "HUD - AR"
WHNSummary$Block[WHNSummary$Block == "GemsCued"] <- "HUD - Cued AR"
WHNSummary$Block[WHNSummary$Block == "GemsTablet"] <- "HDD - AR"
WHNSummary$Block[WHNSummary$Block == "Tablet"] <- "HDD - Tablet"


WHNSummary$Block <- factor(WHNSummary$Block, levels = c("Baseline", "HUD - AR","HUD - Cued AR", "HDD - AR", "HDD - Tablet"))
```

```{r}

ClipSummary <- WHNDataset %>% 
  group_by(image_file) %>% 
  summarise(n = n(),
            WHN = sum(trialResp.corr),
            sdWHN = sd(trialResp.corr))


ClipBlockSummary <- WHNDataset %>% 
  group_by(image_file, Block) %>% 
  summarise(n = n(),
            WHN = sum(trialResp.corr),
            sdWHN = sd(trialResp.corr))

```
```{r}
ggplot(data = ClipSummary, aes(x = image_file, y = WHN, fill = image_file))+
  geom_col()+
  theme(axis.text.x = element_text(angle = 90))+
  labs(xlim(0,NoPpts))
```


```{r}
ggplot(data = ClipBlockSummary, aes(x = image_file, y = WHN, fill = Block))+
  geom_col()+
  theme(axis.text.x = element_text(angle = 90))+
  labs(xlim(0,NoPpts))+
  geom_hline(yintercept = NoPpts)
```


```{r}
ConfSum <- WHNDataset %>% 
  group_by(Block) %>% 
  summarise(n = NoPpts,
            mean = mean(Attention_slider.response, na.rm = T),
            sd = sd(Attention_slider.response, na.rm = T))
```


###End of Data Wrangling####


###############WHN Scores##################

```{r}

WHNBaseline <- as.numeric(WHNSummary[1,3])

ggplot(data = WHNSummary, aes(x = Block, y = WHN, fill = Block))+
  geom_col()+
  geom_errorbar(aes(ymin = WHN - sdWHN, ymax = WHN + sdWHN),
                width = 0.2, 
                position = position_dodge(0.9))+
  geom_hline(yintercept = WHNBaseline, linetype = "dashed", size = 1.0)+
  geom_hline(yintercept = 8, linetype = "solid", size = 1.0)+
  labs(title = "Average WHN Score")+
  ylim(0,8)+
  scale_fill_hue(l = 40)

```

```{r}
WHNANOVA <- aov(trialResp.corr ~ Block , data = WHNDataset)

summary(WHNANOVA)

TukeyHSD(WHNANOVA)

```

#######CONFIDENCE SCORES##############
```{r}
ConfBaseline <- as.numeric(WHNSummary[1,6])


ggplot(data = WHNSummary, aes(x = Block, y = meanConf, fill = Block))+
  geom_col()+
  geom_errorbar(aes(ymin = meanConf - sdConf/2, ymax = meanConf + sdConf/2),
                width = 0.2, 
                position = position_dodge(0.9))+
  geom_hline(yintercept = ConfBaseline, linetype = "dashed", size = 1.0)+
  labs(title = "Average Confidence Score")+
  ylim(0,1.0)+
  scale_fill_hue(l = 40)
```

```{r}
ConfANOVA <- aov(conf_slider.rt ~ Block , data = WHNDataset)

summary(ConfANOVA)

TukeyHSD(ConfANOVA)
```

```{r}
MISCDataset <- WHNDataset %>%
  group_by(trials_3.thisTrialN, Block) %>%
  summarise(mean = mean(MiseryScale.response),
            sd = sd(MiseryScale.response))
  

ggplot(data = MISCDataset, aes(x = trials_3.thisTrialN, y = mean))+
  geom_line(aes(colour  = factor(Block)))+
  geom_ribbon(aes(ymin =MISCDataset$mean - MISCDataset$sd, ymax = MISCDataset$mean + MISCDataset$sd, fill = Block),alpha= 0.2) +  
  labs(title = "MISC Score")
```



```{r}
MISCANOVA <- aov(MiseryScale.response ~ Block , data = WHNDataset)

summary(MISCANOVA)


TukeyHSD(MISCANOVA)

```
#################LMERs################

```{r}
WHNNullModel <- lmer(data = WHNDataset, formula = trialResp.corr ~  (1|participant) + (1|image_file))

summary(WHNNullModel)


WHNModel1 = lmer(data = WHNDataset, formula = trialResp.corr ~ Block + (1|participant) + (1|image_file))

summary(WHNModel1)
```


```{r}
anova(WHNNullModel, WHNModel1)

WHNresults <- report(WHNModel1, CI = 95)

print(WHNresults)
```

```{r}
ConfNullModel <- lmer(data = WHNDataset, formula = conf_slider.response ~  (1|participant) + (1|image_file))

summary(ConfNullModel)

```

```{r}
ConfModel1 = lmer(data = WHNDataset, formula = conf_slider.response ~ Block + (1|participant) + (1|image_file))

summary(ConfModel1)
```


```{r}
anova(ConfNullModel, ConfModel1)


Confresults <- report(ConfModel1, CI = 95)

print(Confresults)
#anova(Model1)
```

```{r}
MISCNullModel <- lmer(data = WHNDataset, formula = MiseryScale.response ~  (1|participant))

summary(MISCNullModel)

```

```{r}
MISCModel1 = lmer(data = WHNDataset, formula = MiseryScale.response ~ Block + (1|participant))

summary(MISCModel1)
```


```{r}
anova(MISCNullModel, MISCModel1)


#anova(Model1)
```

