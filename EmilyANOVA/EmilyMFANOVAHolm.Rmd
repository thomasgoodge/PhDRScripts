---
title: "Emilanalysis"
author: "TGoodge"
date: '2023-03-15'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, warning = FALSE, message = FALSE}
library(readxl)
library(tidyverse)
library(dplyr)
library(rstatix)
library(afex)
library(lme4)
library(emmeans)
library(ggpubr)


```

```{r}
#Bring in Data file
data <-  read.csv("C:/Users/thoma/Documents/sex_anova_df.csv")

femaledata <-  read.csv("C:/Users/thoma/Documents/fem_anova_df.csv")


#data <- rbind(maledata, femaledata)


#Rename DUration column
colnames(data)[colnames(data) == 'Duration_.ms.'] <- 'Duration'


#Remove long strings from ID (Still retains all 144 ppts)
data$ID <- substr(data$ID, 1, 6)  

#Convert relevent columns to factors for ANOVA
data$Duration <- as.factor(data$Duration)
data$Type <- as.factor(data$Type)
data$ID <- as.factor(data$ID)
#data$File <- as.factor(data$File)

data$X <- as.factor(data$X)

#show the levels in the ID factor (Used for debugging)
#levels(data$ID)





```


```{r}
#Plot a very basic histogram of all the data
ggplot(data, aes(x = Rating, fill = Gender ))+
 geom_histogram(binwidth = 1)


```
```{r}
#Boxplot of the data for both within and between conditions
ggplot(data, aes(x=Duration, y=Rating, colour=Type, fill = Gender)) + 
  geom_boxplot(outlier.shape = NA) 
```


```{r}
#Split the data set into 3 based on each Dimensions
AttrData <- data[data$Dimension == 'Attractiveness',]

DomData <- data[data$Dimension == 'Dominance',]

TrustData <- data[data$Dimension == 'Trustworthiness',]

```

```{r}
#Summarise the means and SD ratings for each of the 3 dimensions
AttrSum <- AttrData %>% 
  group_by(Duration, Type, Gender) %>% 
  summarise(n = n(),
            mean = mean(Rating),
            sd = sd(Rating))

DomSum <- DomData %>% 
  group_by(Duration, Type, Gender) %>% 
  summarise(n = n(),
            mean = mean(Rating),
            sd = sd(Rating))


TrustSum <- TrustData %>% 
  group_by(Duration, Type, Gender) %>% 
  summarise(n = n(),
            mean = mean(Rating),
            sd = sd(Rating))
```

```{r}
#plot the spread of the data for each fo the dimensions
ggplot(AttrData, aes(x = Duration, y = Rating, fill = Type ))+
  geom_violin()+
  geom_boxplot()+
  labs(title = "Attractiveness")

ggplot(DomData, aes(x = Duration, y = Rating, fill = Type ))+
  geom_violin()+
  geom_boxplot()+
  labs(title = "Dominance")

ggplot(TrustData, aes(x = Duration, y = Rating, fill = Type ))+
  geom_violin()+
  geom_boxplot()+
  labs(title = "Trustworthiness")

```

```{r}
#check for outliers in the main dataset
outlier<-data %>% 
group_by(Duration,Type, Gender) %>%
identify_outliers(Rating)
data.frame(outlier)
```



```{r}

#plot a quantile-quantile plot to compare distributions
#sigmoidal shape because ratings are between 0 and 100
ggqqplot(data, "Rating", ggtheme = theme_bw()) +
  facet_grid(Type ~ Duration*Gender)


#qqplot(data$Type, data$Rating, xlab = "test x", ylab = "test y", main = "Q-Q Plot")

```
```{r}
#Test assumptions of big data set - not sure if they meet them
data %>% 
  group_by(Duration, Gender) %>% 
  levene_test(Rating ~ Type)

box_m(data[, "Rating", drop = FALSE], data$Duration)


```
```{r}
#FIrst attempt at mixed ANOVA but produces an error due to number of factors
#resATTR <- anova_test(data = AttrData, dv = Rating, between = Duration, within = Type, wid = X)
#get_anova_table(res)
```

```{r}

#Conduct mixed ANOVA for each of the dimensions(next 3 chunks) from the afex package
mixed_anova_Attr <- aov_ez(
  id = "ID",
  dv = "Rating",
  data = AttrData,
  between = "Duration",
  within = c("Type", "Gender")
)

print("Comparisons for Attractiveness")
emmeans(mixed_anova_Attr, ~Type*Gender*Duration, contr = "pairwise", adjust = "holm")

summary(mixed_anova_Attr)
knitr::kable(nice(mixed_anova_Attr))


```


```{r}
mixed_anova_Dom <- aov_ez(
  id = "ID",
  dv = "Rating",
  data = DomData,
  between = "Duration",
  within = c("Type", "Gender"),
  anova_table = list(p_adjust_method = "holm")
)

print("Comparison for Dominance")
emmeans(mixed_anova_Dom, ~Type*Gender*Duration, contr = "pairwise", adjust = "holm")

summary(mixed_anova_Dom)
knitr::kable(nice(mixed_anova_Dom))
```


```{r}
mixed_anova_Trust<- aov_ez(
  id = "ID",
  dv = "Rating",
  data = TrustData,
  between = "Duration",
  within = c("Type","Gender"),
  anova_table = list(p_adjust_method = "holm")
)


summary(mixed_anova_Trust)

#pairwise.t.test(TrustData$Rating, TrustData$Type, p.adjust.method="bonferroni")

print("Comparisons for Trust")
emmeans(mixed_anova_Trust, ~Type*Gender*Duration, contr = "pairwise", adjust = "holm")


knitr::kable(nice(mixed_anova_Trust))

knitr::kable(nice(mixed_anova_Trust))
```

```{r}
#Test sphericity for each of the dimensions

test_sphericity(mixed_anova_Attr)

test_sphericity(mixed_anova_Dom)

test_sphericity(mixed_anova_Trust)

```

```{r}
#Produce horrific plots for each of the dimensions
afex_plot(mixed_anova_Attr, x = "Type", trace = "Duration")
afex_plot(mixed_anova_Dom, x = "Type", trace = "Duration")
afex_plot(mixed_anova_Trust, x = "Type", trace = "Duration")
```

```{r}

#Different method for Mixed ANOVA
Mixed.aov.Attr<-aov_car(Rating ~ Duration*Type + Error(ID/Type), data=AttrData)

summary(Mixed.aov.Attr)
```

```{r}

Mixed_Fitted_Type_Attr<-emmeans(Mixed.aov.Attr, ~Type)
Mixed_Fitted_Type_Attr

Mixed_Fitted_Duration_Attr<-emmeans(Mixed.aov.Attr, ~Duration)
Mixed_Fitted_Duration_Attr

Mixed_Fitted_Interaction_Attr<-emmeans(Mixed.aov.Attr, specs = pairwise ~Type*Duration, type = "response", adjust = "holm")
Mixed_Fitted_Interaction_Attr


knitr::kable((Mixed_Fitted_Interaction_Attr$emmeans))
knitr::kable((Mixed_Fitted_Interaction_Attr$contrast))

```
```{r}
pairs(Mixed_Fitted_Interaction_Attr)
knitr::kable((pairs(Mixed_Fitted_Interaction_Attr)))
```

```{r}
ggplot(AttrData, aes(x = Duration, y = Rating, fill = Type ))+
  geom_boxplot()+
  labs(title = "Attractiveness")
```

```{r}
#Different method for Mixed ANOVA
Mixed.aov.Dom<-aov_car(Rating ~ Duration*Type + Error(ID/Type), data=DomData)

summary(Mixed.aov.Dom)
```

```{r}

Mixed_Fitted_Type_Dom<-emmeans(Mixed.aov.Dom,  ~Type)
Mixed_Fitted_Type_Dom


Mixed_Fitted_Duration_Dom<-emmeans(Mixed.aov.Dom, ~Duration)
Mixed_Fitted_Duration_Dom

Mixed_Fitted_Interaction_Dom<-emmeans(Mixed.aov.Dom, specs = pairwise ~Type*Duration, type = "response", adjust = "holm")
Mixed_Fitted_Interaction_Dom


#contrast(Mixed.aov.Dom, interaction = c("Type", "Duration"))


knitr::kable((Mixed_Fitted_Interaction_Dom$emmeans))
knitr::kable((Mixed_Fitted_Interaction_Dom$contrast))


```

```{r}
pairs(Mixed_Fitted_Interaction_Dom)
knitr::kable((pairs(Mixed_Fitted_Interaction_Dom)))
```


```{r}

pairs2 <- emmeans(Mixed.aov.Dom, pairwise ~Type|Duration)
pairs2

```

```{r}
ggplot(DomData, aes(x = Duration, y = Rating, fill = Type ))+
  geom_boxplot()+
  labs(title = "Dominance")
```

```{r}
#Different method for Mixed ANOVA
Mixed.aov.Trust<-aov_car(Rating ~ Duration*Type + Error(ID/Type), data=TrustData)

summary(Mixed.aov.Trust)
```

```{r}

Mixed_Fitted_Type_Trust<-emmeans(Mixed.aov.Trust, ~Type)
Mixed_Fitted_Type_Trust

Mixed_Fitted_Duration_Trust<-emmeans(Mixed.aov.Trust, ~Duration)
Mixed_Fitted_Duration_Trust

Mixed_Fitted_Interaction_Trust<-emmeans(Mixed.aov.Trust, specs = pairwise ~Type*Duration, type = "response", adjust = "holm")
Mixed_Fitted_Interaction_Trust

knitr::kable((Mixed_Fitted_Interaction_Trust$emmeans))
knitr::kable((Mixed_Fitted_Interaction_Trust$contrast))

```

```{r}

pairs(Mixed_Fitted_Interaction_Trust)
knitr::kable(pairs(Mixed_Fitted_Interaction_Trust))


```

```{r}
ggplot(TrustData, aes(x = Duration, y = Rating, fill = Type ))+
  geom_boxplot()+
  labs(title = "Trustworthiness")
```



```{r}
#Code for mixed effets models
NullModelAttr <- lmer(data = AttrData, formula = Rating ~ (1|ID))
summary(NullModelAttr)

```

```{r}
Model1Attr = lmer(data = AttrData, formula = 0 + Rating ~ Duration * Type * Gender + (1|ID))

summary(Model1Attr)
```


