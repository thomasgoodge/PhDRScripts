---
title: "Study5EyetrackingAnalysis"
author: "TGoodge"
date: "2024-06-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(readr)
library(stringr)
library(tidyr)
library(dplyr)
library(lme4)
library(lmerTest)
library(beepr)
library(cowplot)
library(ggplot2)
library(scatterplot3d)
library(rgl)
library(RColorBrewer)
library(colorspace)

```
#Define palettes
```{r}

base_palette <- brewer.pal(n = 12, name = "Paired")
custom_palette <- c(
  base_palette[3], base_palette[4],   # Group 2: 2 similar colors
    base_palette[1], base_palette[2],   # Group 1: 2 similar colors

  "#F45B5B", base_palette[6], "#A50F15",  # Group 3: 3 similar colors
  base_palette[8]                     # Group 4: 1 color
)


S5_palette <- c(base_palette[3],base_palette[1],"#F45B5B", base_palette[8])
S6_palette <- c(base_palette[4], base_palette[2],base_palette[6], "#A50F15")

S5_palette_darker <- darken (S5_palette, amount = 0.2)
S5_palette_lighter <- lighten (S5_palette, amount = 0.2)

#darkened_palette <- darken(custom_palette, amount = 0.1)

#scale_fill_manual(values = S5_palette) +


# Print the custom palette to verify
print(custom_palette)
#"#A6CEE3" "#1F78B4" "#B2DF8A" "#33A02C" "#FB9A99" "#E31A1C" "#FDBF6F" "#FF7F00" "#F45B5B"
```

#Read in data files
```{r}

FinalValidHazardAOIETData <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study5Analysis/FinalValidHazardAOIETData.csv", header = T)

FinalValidHazardAOIETData <- FinalValidHazardAOIETData[complete.cases(FinalValidHazardAOIETData),]

FinalValidHazardAOIETDataRMOut <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study5Analysis/FinalValidHazardAOIETDataRMOut.csv", header = T)

FinalValidHazardAOIETDataRMOut <- FinalValidHazardAOIETDataRMOut[complete.cases(FinalValidHazardAOIETDataRMOut),]

FinalValidAOIETData <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study5Analysis/FinalValidAOIETData.csv", header = T)

FinalValidAOIETData <- FinalValidAOIETData[complete.cases(FinalValidAOIETData),]

FinalValidAOIETDataRMOut <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study5Analysis/FinalValidAOIETDataRMOut.csv", header = T)

FinalValidAOIETDataRMOut <- FinalValidAOIETDataRMOut[complete.cases(FinalValidAOIETDataRMOut),]

ValidControl <- FinalValidAOIETDataRMOut %>% 
  subset(Condition == "Control")

ValidVisual <- FinalValidAOIETDataRMOut %>% 
  subset(Condition == "Visual")

ValidAvatar <- FinalValidAOIETDataRMOut %>% 
  subset(Condition == "Avatar")

ValidNDRT <- FinalValidAOIETDataRMOut %>% 
  subset(Condition == "NDRT")


```

```{r}

binwidth <- 120  # Adjust the binwidth as needed

# Define the limits for the color scale
color_limits <- c(0, 2000)  # Adjust these limits as needed

# Define the color for values exceeding the limit
exceeding_limit_color <- "yellow"  # Adjust this color as needed

ValidControlPlot <- ggplot(data=ValidControl, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = binwidth)+
    xlim(-0.4, 0.4)+
  ylim(-0.25, 0.25)+
    scale_fill_continuous(type = "viridis",limits = color_limits, na.value = exceeding_limit_color) +
  labs(title= "a) Control")

ValidVisualPlot <- ggplot(data=ValidVisual, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = binwidth)+
    xlim(-0.4, 0.4)+
  ylim(-0.25, 0.25)+
    scale_fill_continuous(type = "viridis",limits = color_limits, na.value = exceeding_limit_color) +
  labs(title= "b) Visual")

ValidAvatarPlot <- ggplot(data=ValidAvatar, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = binwidth)+
    xlim(-0.4, 0.4)+
  ylim(-0.25, 0.25)+
    scale_fill_continuous(type = "viridis",limits = color_limits, na.value = exceeding_limit_color) +
  labs(title= "c) Avatar")

ValidNDRTPlot <- ggplot(data=ValidNDRT, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = binwidth)+
    xlim(-0.4, 0.4)+
  ylim(-0.25, 0.25)+
    scale_fill_continuous(type = "viridis",limits = color_limits, na.value = exceeding_limit_color) +
  labs(title= "d) NDRT")



AOIFixationPlot <- plot_grid(ValidControlPlot, ValidVisualPlot, ValidAvatarPlot, ValidNDRTPlot,ncol = 2)
AOIFixationPlot


ggsave(
    filename = "AOIFixationPlot.png",
    plot = AOIFixationPlot,
    width = 15, height = 10
  )

```
#3D Plots
```{r}
scatterplot3d(x = ValidControl$fixation_x, y = ValidControl$fixation_z, z = ValidControl$fixation_y, highlight.3d = T)

scatterplot3d(x = ValidVisual$fixation_x, y = ValidVisual$fixation_z, z = ValidVisual$fixation_y, highlight.3d = T)

scatterplot3d(x = ValidAvatar$fixation_x, y = ValidAvatar$fixation_z, z = ValidAvatar$fixation_y, highlight.3d = T)

scatterplot3d(x = ValidNDRT$fixation_x, y = ValidNDRT$fixation_z, z = ValidNDRT$fixation_y, highlight.3d = T)
```

#3D Plots Pop outs
```{r}
ValidVisual$FixTarget <- if_else(ValidVisual$gazePoint_target_name == "Wall", "navy", "cyan")

ValidControl$FixTarget <- if_else(ValidControl$gazePoint_target_name == "Wall", "darkgreen", "lightgreen")
ValidAvatar$FixTarget <- if_else(ValidAvatar$gazePoint_target_name == "Wall", "red", "pink")
ValidNDRT$FixTarget <- if_else(ValidNDRT$gazePoint_target_name == "Wall", "orange", "yellow")


# Control3D <- plot3d(x =ValidControl$fixation_x, y = ValidControl$fixation_z, z = ValidControl$fixation_y, col =  ValidControl$FixTarget )
# Visual3D <- plot3d(x =AOIVisualETData$fixation_x, y = AOIVisualETData$fixation_z, z = AOIVisualETData$fixation_y,  col = AOIVisualETData$FixTarget)
# Avatar3D<- plot3d(x =ValidAvatar$fixation_x, y = ValidAvatar$fixation_z, z = ValidAvatar$fixation_y, col = ValidAvatar$FixTarget )
# NDRT3D <- plot3d(x =ValidNDRT$fixation_x, y = ValidNDRT$fixation_z, z = ValidNDRT$fixation_y, col = ValidNDRT$FixTarget )
```


```{r}
# library(plot3D)
# scatter3D(x =ValidVisual$fixation_x, y = ValidVisual$fixation_z, z = ValidVisual$fixation_y, pch = 2,colvar = ValidVisual$fixation_z,bty = "b2", theta = 15, phi = 20 )
# 
# scatter3D(x =ValidNDRT$fixation_x, y = ValidNDRT$fixation_z, z = ValidNDRT$fixation_y, pch = 2,colvar = ValidNDRT$fixation_z,bty = "b2", theta = 15, phi = 20 )

```

```{r}
#Read in Hazard Clip Data

HazardClipList <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study4Analysis/FinalStudy4HazardSheet.csv", header = T)

HazardClipList$VideoClip <- gsub("[^0-9]", "", HazardClipList$VideoClip)# remove all non-numeric characters

HazardClipList$Onset <- HazardClipList$Offset - 4000

HazardClipList$Onset <- HazardClipList$Onset / 1000

HazardClipList$Offset <- HazardClipList$Offset / 1000

HazardClipList$VideoClip <- as.numeric(HazardClipList$VideoClip)

HazardClipList <- HazardClipList[complete.cases(HazardClipList$VideoClip), ] 


HazardClipList <- HazardClipList %>% 
  select(-c(xLocationOnset, xLocationOffset, convertedxLocationOnset, convertedxLocationOffset, yLocationOnset, yLocationOffset, convertedyLocationOnset, convertedyLocationOffset))

```

```{r}
ClipTimes <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study5Analysis/ClipTimes.csv", header = T)

HazardClipTimes <-  ClipTimes

HazardClipTimes$VideoClip <- as.numeric(gsub("[^0-9]", "", HazardClipTimes$image_file))# remove all non-numeric characters

HazardClipTimes <- HazardClipTimes[complete.cases(HazardClipTimes$ETClipStart), ] %>% 
  select(- X)
```

#Hazard Clips Sheet
```{r}
HazardClips <- left_join(HazardClipTimes, HazardClipList, by = "VideoClip")

HazardClips$HazardOnset <- HazardClips$ETClipStart + HazardClips$Onset

HazardClips$HazardOffset <- HazardClips$ETClipStop 

CorrectAOIs <- HazardClips %>% 
  select(VideoClip, AOILocationOffset, AOILocationOffset2)

CorrectAOIs <- CorrectAOIs[!duplicated((CorrectAOIs$VideoClip)),]

CorrectAOIs$VideoClip <- as.double(CorrectAOIs$VideoClip)


```

```{r}
#TTFF

FirstFixation <- FinalValidHazardAOIETDataRMOut %>% 
  subset(CorrAOI == 1)

#FirstFixation <- FirstFixation[!duplicated((FirstFixation$PIDCond)),]

TTFF <- left_join(FirstFixation, HazardClips, by = (c("VideoClip" = "VideoClip", "PIDCond" = "Sort")))
  
TTFF$FirstFixationTime <- TTFF$TimeStamp - TTFF$HazardOnset

TTFF <- TTFF[!duplicated(TTFF$DupSort),]

TTFFWall <- TTFF %>% 
  subset(gazePoint_target_name == "Wall")


TTFFSummary <- TTFF %>% 
  group_by(Condition.x, CorrAOI) %>% 
  summarise(n = n(),
            TTFF = mean(FirstFixationTime))


TTFFWallSummary <- TTFFWall %>% 
  group_by(Condition.x, CorrAOI) %>% 
  summarise(n = n(),
            TTFF = mean(FirstFixationTime),
            sd = sd(FirstFixationTime))

```

#CountData
```{r}
CountData <- FinalValidAOIETDataRMOut

CountData$Sort <- paste(CountData$PIDCond,CountData$eventIndex)
  
CountData <- CountData[!duplicated(CountData$Sort),]

CountData <- CountData %>% 
  subset(ZScore <= 3)

CorrHazardCountData <- FinalValidHazardAOIETDataRMOut

CorrHazardCountData$Sort <-paste(FinalValidHazardAOIETDataRMOut$PIDCond, FinalValidHazardAOIETDataRMOut$eventIndex)
CorrHazardCountData <- CorrHazardCountData[!duplicated(CorrHazardCountData$Sort),]
```
#TTFF
```{r}

FirstFixation <- CorrHazardCountData %>% 
  subset(CorrAOI == 1)

FirstFixation$VidSort <- paste(FirstFixation$PIDCond, FirstFixation$VideoClip)

HazardClips$VidSort <- paste (HazardClips$Participant, HazardClips$Condition, HazardClips$VideoClip)

FirstFixation <- FirstFixation[!duplicated((FirstFixation$DupSort)),]

TTFF <- left_join(FirstFixation, HazardClips, by = (c("VideoClip" = "VideoClip", "VidSort" = "VidSort")))
  
TTFF$FirstFixationTime <- TTFF$TimeStamp - TTFF$HazardOnset

#TTFF <- TTFF[complete.cases(TTFF$FirstFixationTime), ] 

#TTFF$VidSort <- paste (TTFF$Participant, TTFF$Condition, TTFF$VideoClip)



TTFFWallSingle <- TTFFWall

TTFFWallSingle$TTFFSort <- paste(TTFFWallSingle$PIDCond, TTFFWallSingle$VideoClip)


TTFFWallSingle <- TTFFWallSingle[!duplicated((TTFFWallSingle$TTFFSort)),]

TTFFWallSingle <- TTFFWallSingle %>% 
  filter(FirstFixationTime < 4)
#TTFF <- TTFF[!duplicated(TTFF$PIDSort),]

TTFFWall <- TTFF %>% 
  subset(gazePoint_target_name == "Wall")


TTFFSummary <- TTFF %>% 
  group_by(Condition.x, CorrAOI) %>% 
  summarise(n = n(),
            TTFF = mean(FirstFixationTime))


TTFFWallSummary <- TTFFWallSingle %>% 
  group_by(Condition.x, CorrAOI) %>% 
  summarise(n = n(),
            TTFF = mean(FirstFixationTime),
            sd = sd(FirstFixationTime))
```

#Summaries

```{r}

DurationSummary <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

ClipSummary <- CountData %>% 
  group_by(Condition, VideoClip) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

ClipSummaryAOI <- CountData %>% 
  group_by(Condition, VideoClip, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

CountSummaryAOI <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n())

AOITargetSummary <- CountData %>% 
  group_by(Condition, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T))

AOIObjectSummary <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T),
            ARFixation = sum(gazePoint_target_name != "Wall", na.rm = T),
            ScreenFixation = sum(gazePoint_target_name == "Wall" ,na.rm = T),
            ARProp = (sum(gazePoint_target_name != "Wall", na.rm = T) / n() )* 100,
            ScreenProp = (sum(gazePoint_target_name == "Wall", na.rm = T) / n() )* 100
            )

```

```{r}

PptSummaryAOI <- CountData %>% 
  group_by(PIDCond) %>% 
  summarise(NoF = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration))

PptSummaryAOI[c('Ppt','Condition')] <- str_split_fixed(PptSummaryAOI$PIDCond," ",2)


GroupSummary <- PptSummaryAOI %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            sumNoF = sum(NoF),
            meanNoF = mean(NoF),
            sdNoF = sd(NoF),
            meanDuration = mean(meanDuration))

NoFOutliers <- CountData %>% 
  subset(Condition == "Avatar") %>% 
  subset(ID == "P26") %>% 
  subset(gazePoint_target_name == "Wall")


```

#Hazard Summaries
```{r}
HazardSummaryAOI <- CorrHazardCountData %>% 
  group_by(Condition, ) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

HazardClipSummaryAOI <- CorrHazardCountData %>% 
  group_by(Condition, VideoClip) %>% 
  summarise(n = n(),
          
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

HazardAOITargetSummary <- CorrHazardCountData %>%  
  group_by(Condition, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T))

HazardAOIObjectSummary <- CorrHazardCountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T),
            ARFixation = sum(gazePoint_target_name != "Wall", na.rm = T),
            ScreenFixation = sum(gazePoint_target_name == "Wall" ,na.rm = T),
            ARProp = (sum(gazePoint_target_name != "Wall", na.rm = T) / n() )* 100,
            ScreenProp = (sum(gazePoint_target_name == "Wall", na.rm = T) / n() )* 100
            )

HazardCorrSummary <- CorrHazardCountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            sumCorr = sum(CorrAOI, na.rm = T),
            meanCorr = mean(CorrAOI, na.rm = T))


```
#CorrHazard Summaries
```{r}

CorrHazardCountData$FixNum <- 1

CorrHazardFixCountPpt <- CorrHazardCountData %>% 
  group_by(PIDCond, Condition)%>% 
  summarise(NoF = sum(modified, na.rm = T),
            meanDuration = mean(eventDuration,na.rm = T),
            sdDuration = sd(eventDuration,na.rm = T),
            sumCorr = sum(CorrAOI,na.rm = T),
                        propCorr = (sumCorr/NoF)*100
)

CorrHazardFixCountPpt$Condition <- as.factor(CorrHazardFixCountPpt$Condition)

CorrHazardFixCountPpt[c('Ppt','Condition')] <- str_split_fixed(CorrHazardFixCountPpt$PIDCond," ",2)


CorrHazFixCount <- CorrHazardFixCountPpt %>% 
group_by(Condition) %>% 
  summarise(n = n(),
             avgcorrhazfix = mean(sumCorr),
            sd = sd(sumCorr))



CorrHazardPptAOIGroupSummary <- CorrHazardFixCountPpt %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            sumNoF = sum(NoF),
            sumCorrNoF = sum(sumCorr),
            meanNoF = mean(NoF),
            meanCorrNoF = mean(sumCorr),
            meanDuration = mean(meanDuration))


```



#FixCount Summaries
```{r}

FixCountSummary <- CountData %>% 
  group_by(Condition, Target = (gazePoint_target_name == "Wall")) %>% 
  summarise(n = n())%>% 
  drop_na(Target)

PivotFixCountSummary <- FixCountSummary %>% 
  pivot_wider(names_from =  "Target", values_from = n)

dataCHI <- matrix(c(6131,4590,527,3166), ncol = 1, byrow = T)
colnames(dataCHI) <- ("Screen")
rownames(dataCHI) <- c("Control", "Visual","Avatar", "NDRT")

dataCHI <- as.table(dataCHI)

dataCHI

FixCountSummary$Target[FixCountSummary$Target == TRUE] <- "Video"
FixCountSummary$Target[FixCountSummary$Target == FALSE] <- "AR"

FixCountSummary$Condition <- factor(FixCountSummary$Condition, ordered = FALSE)

FixCountSummaryScreen <- FixCountSummary %>% 
  subset(Target == "Video")

FixCountSummaryAR <- FixCountSummary %>% 
  subset(Target == "AR")



FixCountSummaryTotal <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            AVG = n() / length(unique(CountData$ID)),
            SD = sd(n() / length(unique(CountData$ID)), na.rm = T)
            )

PptFixCountTotal <- CountData %>% 
  group_by(ID, Condition) %>% 
  summarise(FixCount = n())

PptFixCountTotalSummary <- PptFixCountTotal %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            avg = mean(FixCount),
            sd = sd(FixCount))

```
#S4 Summaries

```{r}

DurationSummary <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

ClipSummary <- CountData %>% 
  group_by(Condition, VideoClip) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

ClipSummaryAOI <- CountData %>% 
  group_by(Condition, VideoClip, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

CountSummaryAOI <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n())

AOITargetSummary <- CountData %>% 
  group_by(Condition, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T))

AOIObjectSummary <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T),
            ARFixation = sum(gazePoint_target_name != "Wall", na.rm = T),
            ScreenFixation = sum(gazePoint_target_name == "Wall" ,na.rm = T),
            ARProp = (sum(gazePoint_target_name != "Wall", na.rm = T) / n() )* 100,
            ScreenProp = (sum(gazePoint_target_name == "Wall", na.rm = T) / n() )* 100
            )

```

```{r}

PptSummaryAOI <- CountData %>% 
  group_by(PIDCond) %>% 
  summarise(NoF = sum(modified),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration))

PptSummaryAOI[c('Ppt','Condition')] <- str_split_fixed(PptSummaryAOI$PIDCond," ",2)


GroupSummary <- PptSummaryAOI %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            sumNoF = sum(NoF),
            meanNoF = mean(NoF),
            sdNoF = sd(NoF),
            meanDuration = mean(meanDuration))
```

#Hazard Summaries
```{r}
HazardSummaryAOI <- CorrHazardCountData %>% 
  group_by(Condition, ) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

HazardClipSummaryAOI <- CorrHazardCountData %>% 
  group_by(Condition, VideoClip) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

HazardAOITargetSummary <- CorrHazardCountData %>%  
  group_by(Condition, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T))

HazardAOIObjectSummary <- CorrHazardCountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T),
            ARFixation = sum(gazePoint_target_name != "Wall", na.rm = T),
            ScreenFixation = sum(gazePoint_target_name == "Wall" ,na.rm = T),
            ARProp = (sum(gazePoint_target_name != "Wall", na.rm = T) / n() )* 100,
            ScreenProp = (sum(gazePoint_target_name == "Wall", na.rm = T) / n() )* 100
            )

HazardCorrSummary <- CorrHazardCountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            sumCorr = sum(CorrAOI),
            meanCorr = mean(CorrAOI))


```

```{r}

CorrHazardPptSummaryAOI <- CorrHazardCountData %>% 
  group_by(PIDCond, Condition) %>% 
  summarise(NoF = sum(modified),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            sumCorr = sum(CorrAOI),
            propCorr = (sumCorr / NoF)*100)


CorrHazCount <- CorrHazardPptSummaryAOI %>% 
group_by(Condition) %>% 
  summarise(n = n(),
             avgcorrhazfix = mean(sumCorr),
            sd = sd(sumCorr),
            meanProp = mean(propCorr))

CorrHazardPptSummaryAOI[c('Ppt','Condition')] <- str_split_fixed(CorrHazardPptSummaryAOI$PIDCond," ",2)


CorrGroupSummary <- CorrHazardPptSummaryAOI %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            sumNoF = sum(NoF),
            sumCorrNoF = sum(sumCorr),
            meanNoF = mean(NoF),
            sdNoF = sd(NoF),
            meanCorrNoF = mean(sumCorr),
            sdCorrNoF = sd(sumCorr),
            meanDur = mean(meanDuration),
            sdDur = sd(meanDuration))


```


#FixCount Summaries
```{r}

FixCountSummary <- CountData %>% 
  group_by(Condition, Target = (gazePoint_target_name == "Wall")) %>% 
  summarise(n = n())%>% 
  drop_na(Target)

PivotFixCountSummary <- FixCountSummary %>% 
  pivot_wider(names_from =  "Target", values_from = n)

dataCHI <- matrix(c(6131,4590,527,3166), ncol = 1, byrow = T)
colnames(dataCHI) <- ("Screen")
rownames(dataCHI) <- c("Control", "NDRT","Avatar", "Visual")

dataCHI <- as.table(dataCHI)

dataCHI

FixCountSummary$Target[FixCountSummary$Target == TRUE] <- "Video"
FixCountSummary$Target[FixCountSummary$Target == FALSE] <- "AR"

FixCountSummary$Condition <- factor(FixCountSummary$Condition, ordered = FALSE)

FixCountSummaryScreen <- FixCountSummary %>% 
  subset(Target == "Video")

FixCountSummaryAR <- FixCountSummary %>% 
  subset(Target == "AR")



FixCountSummaryTotal <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            AVG = n() / length(unique(CountData$ID)),
            SD = sd(n() / length(unique(CountData$ID)))
            )

PptFixCountTotal <- CountData %>% 
  group_by(ID, Condition) %>% 
  summarise(FixCount = n())

PptFixCountTotalSummary <- PptFixCountTotal %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            avg = mean(FixCount),
            sd = sd(FixCount))

```
#STATS

# Fixation Count - Stats
```{r}
library(lmerTest)
FixCountChi <- chisq.test(dataCHI)
FixCountChi$observed

FixCountChi


FixCountAnova <- aov(data = PptSummaryAOI, NoF ~ Condition)
summary(FixCountAnova)
qqnorm(sqrt(PptSummaryAOI$NoF))
TukeyHSD(FixCountAnova)

PptSummaryAOI$Condition <- factor(PptSummaryAOI$Condition, levels = c("Control", "Visual", "Avatar", "NDRT"))

PptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "Control")


FixCountLM <- lm(data =PptSummaryAOI, NoF ~ Condition,  family = "poisson")
summary(FixCountLM)


FixCountLMER <- lmer(data =PptSummaryAOI, NoF ~ Condition + (1|Ppt) )
summary(FixCountLMER)



library(report)
FixCountResults <- report(FixCountLMER, CI = 95)
 #ef <- as.data.frame(effects("Condition", FixCountResults))
#head(ef)
summary(FixCountResults)

```
#Data with Avatar outliers removed
```{r}
df <- data.frame(PptSummaryAOI$NoF)

z_scores <- as.data.frame(sapply(df, function(df) (abs(df-mean(df))/sd(df))))

z_scores$ZScores <- z_scores$PptSummaryAOI.NoF
# z_scores <- z_scores %>% 
#   select(-1)

PptSummaryAOI$ZScore <- z_scores$ZScores

PptSummaryAOIRMOut <- PptSummaryAOI %>% 
  subset(ZScore <= 3)

PptSummaryAOIRMOut$Condition <- factor(PptSummaryAOIRMOut$Condition, levels = c("Control", "Visual", "Avatar", "NDRT"))


FixCountAnova <- aov(data = PptSummaryAOIRMOut, NoF ~ Condition)
summary(FixCountAnova)
TukeyHSD(FixCountAnova)


FixCountLM <- lm(data =PptSummaryAOIRMOut, NoF ~ Condition,  family = "poisson")
summary(FixCountLM)
```




#***WRITEUP***  Total NoF Plot

```{r}

PptSummaryAOI$Condition <- factor(PptSummaryAOI$Condition, levels = c("Control", "Visual", "Avatar", "NDRT"))

TotalNoFPlot <-ggplot(data = PptSummaryAOI, aes(x = Condition, y = NoF, fill = Condition))+
  geom_violin(alpha = 0.5)+
  geom_boxplot(width = 0.12)+
 # ylim(0,100)+
  labs(title = "Mean Number of Overall Fixations \n \n", y = "Mean Fixation Count", x = "NDRT Presentation Condition")+ # ylim(0,100)+
scale_fill_manual(values = S5_palette) +
  theme_classic()+
    theme(legend.position="none")+
  theme(plot.title = element_text(size = 15,vjust = 1)
  )


FixCountLM <- lm(data =PptSummaryAOI, NoF ~ Condition,  family = "poisson")
summary(FixCountLM)

FixCountLMER <- lmer(data =PptSummaryAOI, NoF ~ Condition + (1|Ppt))
summary(FixCountLMER)


TotalNoFPlot

ggsave(filename = "S5TotalNoFPlot.png",
       plot = TotalNoFPlot)
       
       # ,
       # scale = 3,
       # device = png,
       # width = 3840,
       # units = "px",
       # dpi = 700)
```

```{r}
TotalNoFPlotRMOut <-ggplot(data = PptSummaryAOIRMOut, aes(x = Condition, y = NoF, fill = Condition))+
  geom_violin(alpha = 0.5)+
  geom_boxplot(width = 0.12)+
  #ylim(0,180)+
  labs(title = "Mean Number of Overall Fixations \n \n", y = "Mean Fixation Count", x = "NDRT Presentation Condition")+ # ylim(0,100)+
scale_fill_manual(values = S5_palette) +
  theme_classic()+
    theme(legend.position="none")


FixCountRMOutLMER <- lmer(data =PptSummaryAOIRMOut, NoF ~ Condition + (1|Ppt))
summary(FixCountRMOutLMER)


TotalNoFPlotRMOut

ggsave(filename = "S5TotalNoFPlotRMOut.png",
       plot = TotalNoFPlotRMOut)
```




#Hazard Fixation Count

```{r}

HazFixCountSummary <- CorrHazardCountData %>% 
  group_by(Condition, Target = (gazePoint_target_name == "Wall")) %>% 
  summarise(n = n(),
            NumCorr = sum(CorrAOI, na.rm = T),
            prop = (NumCorr) / n() * 100) %>% 
  drop_na(Target)

HazFixCountSummary$Target[HazFixCountSummary$Target == TRUE] <- "Video"
HazFixCountSummary$Target[HazFixCountSummary$Target == FALSE] <- "AR"

HazFixCountSummary$Condition <- factor(HazFixCountSummary$Condition, ordered = FALSE)


HazFixCountSummaryScreen <- HazFixCountSummary %>% 
  subset(Target == "Video")

HazFixCountSummaryAR <- HazFixCountSummary %>% 
  subset(Target == "AR")

TTFFSummary <- CorrHazardCountData %>% 
  group_by(Condition, PIDCond, CorrAOI) %>% 
  summarise(n = n(),
          TTFF = min(TimeStamp)) %>% 
  group_by(Condition, CorrAOI) %>% 
  summarise(n = n(),
            TTFF = mean(TTFF))

HazFixCountSummaryTotal <- CorrHazardCountData %>% 
  group_by(Condition) %>% 
  summarise(n = n())


PptHazFixCountTotal <- CorrHazardCountData %>% 
  group_by(ID, Condition) %>% 
  summarise(HazFixCount = n())

PptHazFixCountTotalSummary <- PptHazFixCountTotal %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            avgHaz = mean(HazFixCount),
            sd = sd(HazFixCount))



```
#haz Fix Count Stats

```{r}
HazFixCountChi <- chisq.test(HazardSummaryAOI$n)
HazFixCountChi

CorrHazardFixCountPpt$Condition <- factor(PptSummaryAOI$Condition, ordered = FALSE)


CorrHazardFixCountPpt$Ppt <- as.factor(PptSummaryAOI$Ppt)

CorrHazardFixCountPpt$Condition <- relevel(PptSummaryAOI$Condition, ref = "Control")


HazFixCountLM <- lm(data =CorrHazardFixCountPpt, NoF ~ Condition, family = "poisson")
summary(HazFixCountLM)


HazFixCountLMER <- lmer(data =CorrHazardFixCountPpt, NoF ~ Condition + (1|Ppt))
summary(HazFixCountLMER)

HazFixCountResults <- report(HazFixCountLM, CI = 95)

summary(HazFixCountResults)


```


```{r}
CorrHazFix <- aov(data = CorrHazardFixCountPpt, sumCorr ~ Condition )

summary(CorrHazFix)

TukeyHSD(CorrHazFix)

PptSummaryAOI$Condition <- as.factor(PptSummaryAOI$Condition)

PptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "Control")

NumCorrHazFixLM <- lm(sumCorr ~ Condition, data = CorrHazardFixCountPpt)
summary(NumCorrHazFixLM)


```

```{r}
# CorrHazFixCountChi <- chisq.test(HazardCorrSummary$sumCorr)
# 
# CorrHazFixCountChi

```

#***WRITEUP***  Hazard NoF Plot

```{r}

CorrHazardFixCountPpt$Condition <- relevel(CorrHazardFixCountPpt$Condition, ref = "Control")


TotalHazardNoFPlot <- ggplot(data = CorrHazardFixCountPpt, aes(x = Condition, y = NoF, fill = Condition))+
  geom_violin(alpha = 0.5)+
  geom_boxplot(width = 0.07)+
  labs(title = "Mean Number of Fixations during the Hazard Window \n \n", y = "Mean Fixation Count", x = "NDRT Presentation Condition")+scale_fill_manual(values = S5_palette) +
  theme_classic()+
  theme(legend.position="none",
        axis.title.y = element_text(size = 9))+
    theme(plot.title = element_text(size = 15,vjust = 1)
    )


HazFixCountLMER <- lmer(data =CorrHazardFixCountPpt, NoF ~ Condition + (1|Ppt))
summary(HazFixCountLMER)


TotalHazardNoFPlot

ggsave(filename = "S5TotalHazardNoFPlot.png",
       plot = TotalHazardNoFPlot)
       
       # ,
       # scale = 3,
       # device = png,
       # width = 3840,
       # units = "px",
       # dpi = 700)
```

#Hazard FixationCount Corr AOI Plot
```{r}
FixCountCorrScreen <- chisq.test(HazFixCountSummaryScreen$NumCorr, y = NULL)
FixCountCorrScreen

CorrHazFixLM <- lm( sumCorr ~ Condition, data = CorrHazardFixCountPpt)
summary(CorrHazFixLM)

CorrHazFixLMER <- lmer(sumCorr ~ Condition + (1|Ppt), data = CorrHazardFixCountPpt)
summary(CorrHazFixLMER)


```
#***WRITEUP***  Correct Hazard Fixations plot
```{r}
# ggplot(data = CorrHazardPptSummaryAOI, aes(x = Condition, y = sumCorr, fill = Condition))+
#   geom_col()+ 
#   ylab("Number of 'Correct' Fixations")+
#   scale_fill_brewer(palette = "BrBG")+
#   theme_classic()
# 
# plot(HazFixCountSummaryScreen$NumCorr)

CorrHazardFixCountPpt$Condition <- factor(CorrHazardFixCountPpt$Condition, levels = c("Control", "Visual", "Avatar", "NDRT"))

NumCorrHazFixLMER <- lmer(sumCorr ~ Condition + (1|Ppt), data = CorrHazardFixCountPpt )
summary(NumCorrHazFixLMER)

TotalCorrHazardNoFPlot <- ggplot(data = CorrHazardFixCountPpt, aes(x = Condition, y = sumCorr, fill = Condition))+
  geom_violin(alpha = 0.5)+
  geom_boxplot(width = 0.25)+
  labs(title = "Mean Number Correct Fixations \n during Hazard Window ", y = "Mean Correct Fixations", x = "NDRT Presentation Condition")+


scale_fill_manual(values = S5_palette) +
  theme_classic()+
    theme(legend.position="none")+
    theme(text=element_text(size = 10))+
    theme(axis.text=element_text(size=10))

TotalCorrHazardNoFPlot

ggsave(filename = "S5TotalCorrHazardNoFPlot.png",
       plot = TotalCorrHazardNoFPlot)
       #scale = 3)

```

#***WRITEUP*** Prop  Correct Hazard Fixations plot
```{r}
# ggplot(data = CorrHazardPptSummaryAOI, aes(x = Condition, y = sumCorr, fill = Condition))+
#   geom_col()+ 
#   ylab("Number of 'Correct' Fixations")+
#   scale_fill_brewer(palette = "BrBG")+
#   theme_classic()
# 
# plot(HazFixCountSummaryScreen$NumCorr)

#CorrHazardFixCountPpt$Condition <- relevel(CorrHazardFixCountPpt$Condition, ref = "Control")

CorrHazardFixCountPpt$Condition <- factor(CorrHazardFixCountPpt$Condition, levels = c("Control", "Visual", "Avatar", "NDRT"))

PropCorrHazFixLMER <- lmer(propCorr ~ Condition + (1|Ppt), data = CorrHazardFixCountPpt)
summary(PropCorrHazFixLMER)

PropCorrHazardNoFPlot <- ggplot(data = CorrHazardFixCountPpt, aes(x = Condition, y = propCorr, fill = Condition))+
  geom_violin(alpha = 0.5)+
  geom_boxplot(width = 0.2)+
  ylim(0,100)+
  labs(title = "Mean Proportion of Correct Fixations \n during the Hazard Window", y = "Proportion of Correct Fixations", x = "NDRT Presentation Condition")+


scale_fill_manual(values = S5_palette) +
  theme_classic()+
    theme(legend.position="none")+
    theme(text=element_text(size = 10))+
    theme(axis.text=element_text(size=10))+
      theme(plot.title = element_text(size = 12,vjust = 1)
    )

PropCorrHazardNoFPlot

ggsave(filename = "S5PropCorrHazardNoFPlot.png",
       plot = PropCorrHazardNoFPlot)
       #scale = 3)

```

#CowPlot
```{r}
library(cowplot)

legend_b <- get_legend(
  TotalHazardNoFPlot + 
    guides(color = guide_legend(nrow = 1)) +
   theme(legend.position = "bottom")
)

AllTotalNoF <- plot_grid(TotalNoFPlotRMOut, TotalHazardNoFPlot,labels = c('a)','b)'),ncol = 2)
AllTotalNoFLeg <- plot_grid(AllTotalNoF, legend_b,ncol = 1, rel_heights = c(1, .1))
AllTotalNoFLeg

ggsave(filename = "AllTotalNoFLeg.png",
       plot = AllTotalNoFLeg,
       width = 3840,
       units = "px")
```


#CowPlot CorrHaz
```{r}
library(cowplot)

legend_b <- get_legend(
  TotalHazardNoFPlot + 
    guides(color = guide_legend(nrow = 1)) +
   theme(legend.position = "bottom")
)

AllCorrHaz<- plot_grid(TotalCorrHazardNoFPlot, PropCorrHazardNoFPlot, labels = c('a)','b)'),ncol = 2, label_x = 0.05)
AllCorrHazLeg <- plot_grid(AllCorrHaz, legend_b,ncol = 1, rel_heights = c(1, .1))
AllCorrHazLeg

ggsave(filename = "AllCorrHazLeg.png",
       plot = AllCorrHazLeg,
     
       units = "px")
```


```{r}

CorrHazardFixCountPpt$Condition <- as.factor(CorrHazardFixCountPpt$Condition)

#CorrHazardPptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "Control")


CorrHazFixCountLM <- lm(data =CorrHazardFixCountPpt, sumCorr ~ Condition, family = "poisson")
summary(CorrHazFixCountLM)

CorrHazFixLMER <- lmer(sumCorr ~ Condition + (1|Ppt), data = CorrHazardFixCountPpt)
summary(CorrHazFixLMER)

CorrHazFixCountResults <- report(CorrHazFixLMER, CI = 95)

summary(CorrHazFixCountResults)

```


```{r}
hist(CountData$eventDuration)

shapiro.test(CountData$eventDuration[0:5000])
#ad.hoc.test(FinalValidAOIETDataRMOut$eventDuration)

qqnorm(sqrt(CountData$eventDuration))
ggplot(CountData, aes(x = eventDuration, fill = Condition)) + geom_density(alpha = .3)

```

```{r}
library(ggpubr)

bxp <- ggboxplot(CountData, x = "Condition", y = "eventDuration")
bxp
```

```{r}
summary(lm(eventDuration ~ Condition, data = CountData))

BasicDwellAOV <- summary(aov(eventDuration ~ Condition, data = CountData))

#BasicDwellAOVPW <- pairwise.t.test()

#DwellModel <- glmer(eventDuration ~ Condition + (1|ID), data = FinalValidAOIETDataRMOut, family = poisson)

```



```{r}
bxpRMOut <- ggboxplot(CountData, x = "Condition", y = "eventDuration")
bxpRMOut

ggplot(CountData, aes(x = Condition, y = eventDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration (ms)")+
  theme_classic()+
    scale_fill_brewer(palette = "BrBG")

```



```{r}
a1 <- aov(eventDuration ~ Condition, data = CountData)
summary(a1)

Tukeya1 <- TukeyHSD(a1)
Tukeya1

a2 <- aov(meanDuration ~ Condition, data = PptSummaryAOI)
summary(a2)

Tukeya2 <- TukeyHSD(a2)
Tukeya2

```

```{r}
ggplot(FinalValidAOIETDataRMOut, aes(x = Condition, y = eventDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration (ms)")+
  theme_classic()+
    scale_fill_brewer(palette = "BrBG")

ggplot(CountData, aes(x = Condition, y = eventDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration (ms)")+
  theme_classic()+
    scale_fill_brewer(palette = "BrBG")

ggplot(PptSummaryAOI, aes(x = Condition, y = meanDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration (ms)")+
  theme_classic()+
    scale_fill_brewer(palette = "BrBG")

```

```{r}
FinalValidAOIETDataRMOut$Condition <- as.factor(FinalValidAOIETDataRMOut$Condition)

#DurModelNull <- lmer(eventDuration ~ (1|ID), data = FinalValidAOIETDataRMOut)
# 
# DurModelBasic <- lmer(data = FinalValidAOIETDataRMOut, formula = eventDuration ~ Condition + (1|ID))
# 
# summary(DurModelBasic)
# 
# DurModel1 <- lmer(data = FinalValidAOIETDataRMOut,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip))
# summary(DurModel1)

#DurModel2 <- lmer(data = FinalValidAOIETDataRMOut,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePointAOI_name))
#summary(DurModel2)

#DurModel3 <- lmer(data = FinalValidAOIETDataRMOut,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePoint_target_name) + (1|gazePointAOI_name))
#summary(DurModel3)

FinalValidAOIETDataRMOut$Condition <- relevel(FinalValidAOIETDataRMOut$Condition, ref = "Control")

# anova(DurModelNull, DurModelBasic, DurModel1, DurModel2,DurModel3)

```

#Fix Dur Count Data
```{r}
CountData$Condition <- as.factor(CountData$Condition)

DurModelNull <- lmer(eventDuration ~ (1|ID), data = CountData)

DurModelBasic <- lmer(data = CountData, formula = eventDuration ~ Condition + (1|ID))

summary(DurModelBasic)

# DurModel1 <- lmer(data = CountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip))
# summary(DurModel1)
# 
# DurModel2 <- lmer(data = CountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePointAOI_name))
# summary(DurModel2)
# 
# DurModel3 <- lmer(data = CountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePoint_target_name) + (1|gazePointAOI_name))
# summary(DurModel3)
# 
# DurModel4 <- lmer(data = CountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePoint_target_name) + (1|gazePointAOI_name) + (1|TimeStamp))
# summary(DurModel4)
# 
# CountData$Condition <- relevel(CountData$Condition, ref = "Control")

#anova(DurModelNull, DurModelBasic, DurModel1, DurModel2,DurModel3, DurModel4)

```

#FixDur Ppt Mean data
```{r}
PptSummaryAOI$Condition <- as.factor(PptSummaryAOI$Condition)

DurModelNull <- lmer(meanDuration ~ (1|Ppt), data = PptSummaryAOI)

DurModelBasic <- lm(data = PptSummaryAOI, formula = meanDuration ~ Condition, family = "poisson")




#DurModelBasic <- lmer(data = PptSummaryAOI, formula = meanDuration ~ Condition + (1|Ppt))

summary(DurModelBasic)
qqnorm(sqrt(PptSummaryAOI$meanDuration))
PptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "Control")

#anova(DurModelNull, DurModelBasic, DurModel1, DurModel2,DurModel3, DurModel4)

DurModelBasicLMER <- lmer(data = PptSummaryAOI, formula = meanDuration ~ Condition + (1|Ppt))

DurModelResults <- report(DurModelBasicLMER, CI = 95)

summary(DurModelResults)


```


#***WRITEUP***  Total Fixation Duration Plot
```{r}

PptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "Control")


DurModelBasicLMER <- lmer(data = PptSummaryAOI, formula = meanDuration ~ Condition + (1|Ppt))
summary(DurModelBasicLMER)


TotalFixDurPlot <- ggplot(data = PptSummaryAOI, aes(x = Condition, y = meanDuration, fill = Condition))+
  geom_violin(alpha = 0.5)+
  geom_boxplot(width = 0.2)+
scale_fill_manual(values = S5_palette) +
    labs(title = "Mean Overall Fixation Duration \n \n", y = "Fixation Duration (ms)", x = "NDRT Presentation Condition")+

  theme_classic()+
   theme(legend.position="none")

TotalFixDurPlot

ggsave(filename = "S5TotalFixDurPlot.jpg",
       plot = TotalFixDurPlot)
       
       # ,
       # scale = 3,
       # device = png,
       # width = 3840,
       # units = "px",
       # dpi = 700)
```


```{r}
ggplot(FinalValidHazardAOIETDataRMOut, aes(x = Condition, y = eventDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration in Hazard Window")+
  theme_classic()

```
#TTFF Model

```{r}
TTFF$Condition <- TTFF$Condition.x

TTFF$Condition <- as.factor(TTFF$Condition)

TTFFWall$Condition <- TTFFWall$Condition.x

TTFFWall$Condition <- as.factor(TTFFWall$Condition)

TTFF$Condition <- relevel(TTFF$Condition, ref = "Control")

TTFFWall$Condition <- relevel(TTFFWall$Condition, ref = "Visual")


TTFFWallSingle <- TTFFWall

TTFFWallSingle$TTFFSort <- paste(TTFFWallSingle$PIDCond, TTFFWallSingle$VideoClip)


TTFFWallSingle <- TTFFWallSingle[!duplicated((TTFFWallSingle$TTFFSort)),]



```


```{r}
TTFFANOVA <- aov(FirstFixationTime ~ Condition, data = TTFF)

summary(TTFFANOVA)

# TTFFModelNull <- lmer(FirstFixationTime ~ (1|Participant), data = TTFF)
# 
# TTFFModelBasic <- lmer(data = TTFF, formula = FirstFixationTime ~ Condition + (1|Participant))
# summary(TTFFModelBasic)
# 
# TTFFModel1 <- lmer(data = TTFF,  formula = FirstFixationTime ~ Condition + (1|Participant) + (1|VideoClip))
# summary(TTFFModel1)
# 
# TTFFModel2 <- lmer(data = TTFF,  formula = FirstFixationTime ~ Condition + (1|Participant) + (1|VideoClip) + (1|gazePointAOI_name))
# summary(TTFFModel2)
# 
# TTFFModel3 <- lmer(data = TTFF,  formula = FirstFixationTime ~ Condition + (1|Participant) + (1|VideoClip) + (1|gazePoint_target_name) + (1|gazePointAOI_name))
# summary(TTFFModel3)
# 
# anova(TTFFModelNull,TTFFModelBasic,TTFFModel1,TTFFModel2,TTFFModel3)

```

```{r}
TTFFModelBasic <- lm(data = TTFFWallSingle, formula = eventDuration ~ Condition)

summary(TTFFModelBasic)


TTFFWallModelBasic <- lm(data = TTFFWall, formula = eventDuration ~ Condition.x)

#DurModelBasic <- lmer(data = PptSummaryAOI, formula = meanDuration ~ Condition + (1|Ppt))

summary(TTFFWallModelBasic)

PptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "Control")
```

```{r}


TTFFNullLMER <- lmer(data = TTFFWallSingle, formula = FirstFixationTime ~  (1|ID))
TTFFModelLMER <- lmer(data = TTFFWallSingle, formula = FirstFixationTime ~ Condition + (1|ID))

TTFFModelLMER2 <- lmer(data = TTFFWallSingle, formula = FirstFixationTime ~ Condition + (1|ID) + (1|VideoClip))

TTFFModelLMER3 <- lmer(data = TTFFWallSingle, formula = FirstFixationTime ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePointAOI_name))

TTFFModelLMER4 <- lmer(data = TTFFWallSingle, formula = FirstFixationTime ~ Condition + (1|ID) + (1|VideoClip) + (1 + gazePointAOI_name|AOILocationOffset.y) + (1|eventDuration))

TTFFModelLMER5 <- lmer(data = TTFFWallSingle, formula = FirstFixationTime ~ Condition + (1+VideoClip|ID))

summary(TTFFModelLMER4)
                       
   
anova(TTFFNullLMER, TTFFModelLMER, TTFFModelLMER2,TTFFModelLMER3,TTFFModelLMER4,TTFFModelLMER5)

                    
```


#***WRITEUP***  Time to First Fixation
```{r}

TTFFWallSingle$Condition <- relevel(TTFFWallSingle$Condition, ref = "Control")


TTFFModelBasic <- lm(data = TTFFWallSingle, formula = FirstFixationTime ~ Condition)

summary(TTFFModelBasic)

TTFFModelLMER <- lmer(data = TTFFWallSingle, formula = FirstFixationTime ~ Condition + (1|ID))

TTFFModelLMER3 <- lmer(data = TTFFWallSingle, formula = FirstFixationTime ~ Condition + (1|ID) + (1|VideoClip))

ranef(TTFFModelLMER3)
summary(TTFFModelLMER3)


TTFFPlot <- ggplot(TTFFWallSingle, aes(x = Condition, y = FirstFixationTime, fill = Condition))+
  geom_violin(alpha = 0.5)+ 
  geom_boxplot(width = 0.05)+
  ylim(0,4)+
    labs(title = "Mean Time to First Fixation \n \n", y = "Time to First Fixation (ms)", x = "NDRT Presentation Condition")+

scale_fill_manual(values = S5_palette) +

  theme_classic()


TTFFPlot
ggsave(filename = "S5TTFFPlot.png",
       plot = TTFFPlot)
       
```
```{r}

TTFFModelResults <- report(TTFFModelLMER3, CI = 95)

summary(TTFFModelResults)

```



HazardFixation Duration
```{r}
CorrHazardCountData$Condition <- as.factor(CorrHazardCountData$Condition)
CorrHazardCountData$Condition <- relevel(CorrHazardCountData$Condition, ref = "Control")

HazDurModelNull <- lmer(eventDuration ~ (1|ID), data = CorrHazardCountData)

HazDurModelBasic <- lmer(data = CorrHazardCountData, formula = eventDuration ~ Condition + (1|ID))

summary(HazDurModelBasic)

# HazDurModel1 <- lmer(data = CorrHazardCountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip))
# summary(HazDurModel1)
# 
# HazDurModel2 <- lmer(data = CorrHazardCountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePointAOI_name))
# summary(HazDurModel2)
# 
# HazDurModel3 <- lmer(data = CorrHazardCountData,  formula = eventDuration ~ Condition + (1|ID)  + (1|gazePointAOI_name))
# summary(HazDurModel3)

#anova(HazDurModelNull, HazDurModelBasic, HazDurModel1, HazDurModel2, HazDurModel3)

```

#CountHazardFixationDuration - Ppt summary
```{r}
# CorrHazardFixCountPpt$Condition <- as.factor(CorrHazardFixCountPpt$Condition)
# CorrHazardFixCountPpt$Condition <- relevel(CorrHazardFixCountPpt$Condition, ref = "Control")
# 
# #CorrHazardFixCountPpt$Condition <- relevel(CorrHazardFixCountPpt$Condition, ref = "Cue")


FixDurModelBasic <- lmer(data = PptSummaryAOI, formula = meanDuration ~ Condition + (1|Ppt))
summary(FixDurModelBasic)


HazDurModelBasic <- lmer(data = CorrHazardFixCountPpt, formula = meanDuration ~ Condition + (1|Ppt))
summary(HazDurModelBasic)

HazFixDurResults <- report(HazDurModelBasic, CI = 95)

summary(HazFixDurResults)

```

#***WRITEUP*** Haz Fix Dura  Plot
```{r}
CorrHazardFixCountPpt$Condition <- relevel(CorrHazardFixCountPpt$Condition, ref = "Control")

HazDurModelBasic <- lmer(data = CorrHazardFixCountPpt, formula = meanDuration ~ Condition + (1|Ppt))
summary(HazDurModelBasic)

TotalHazFixDurPlot <- ggplot(data = CorrHazardFixCountPpt, aes(x = Condition, y = meanDuration, fill = Condition))+
  geom_violin(alpha = 0.5)+
  geom_boxplot(width = 0.1)+
    labs(title = "Mean Overall Fixation Duation  \n in the Hazard Window \n \n", y = "Fixation Duration (ms)", x = "NDRT Presentation Condition")+
scale_fill_manual(values = S5_palette) +
  theme_classic()+
   theme(legend.position="none")

TotalHazFixDurPlot

ggsave(filename = "S5TotalHazFixDurPlot.jpg",
       plot = TotalHazFixDurPlot)
       
```

#cowplot2
```{r}

legend_c <- get_legend(
  TotalFixDurPlot + 
    guides(color = guide_legend(nrow = 1)) +
   theme(legend.position = "bottom")
)

AllFixDur <- plot_grid(TotalFixDurPlot, TotalHazFixDurPlot,labels = c('a)','b)'),ncol = 2)
AllFixDurLeg <- plot_grid(AllFixDur, legend_c,ncol = 1, rel_heights = c(1, .1))
AllFixDurLeg

ggsave(filename = "S5AllFixDurLeg.jpg",
       plot = AllFixDurLeg,
       width = 3840,
       units = "px")
```

