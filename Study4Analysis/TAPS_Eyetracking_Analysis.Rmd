---
title: "TAPS_Eyetracking_Analysis"
author: "TGoodge"
date: '2024-02-09'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(readr)
library(stringr)
library(tidyr)
library(dplyr)
library(lme4)
library(lmerTest)
library(beepr)
library(cowplot)
```
#ARETT Functions

```{r}
#set the working directory to the ARETT package
#setwd("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R/ARETT-R-Package-master/R")

#source all the ARETT functions from the R folder
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/calculate_velocity.R")
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/classify_iaoi.R")
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/classify_idt.R")
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/classify_ivt.R")
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/discard_short_fixations.R")
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/gap_fill.R")
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/merge_fixations_iaoi.R")
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/merge_fixations_idt.R")
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/merge_fixations_ivt.R")
source("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/ARETT-R-Package-master/R/noise_reduction.R")
```
#START FROM HERE
#Final dataset without outliers
```{r}

FinalValidAOIETDataRMOut <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study4Analysis/FinalValidAOIETDataRMOut.csv", header = T)


ValidControl <- FinalValidAOIETDataRMOut %>% 
  subset(Condition == "Control")

ValidHUD <- FinalValidAOIETDataRMOut %>% 
  subset(Condition == "HUD")

ValidCue <- FinalValidAOIETDataRMOut %>% 
  subset(Condition == "Cue")

ValidHDD <- FinalValidAOIETDataRMOut %>% 
  subset(Condition == "HDD")


```

```{r}
ValidControlPlot <- ggplot(data=ValidControl, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
    xlim(-0.5, 0.5)+
  ylim(-0.3, 0.3)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "Control")

ValidCHUDPlot <- ggplot(data=ValidHUD, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
    xlim(-0.5, 0.5)+
  ylim(-0.3, 0.3)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "HUD")

ValidCuePlot <- ggplot(data=ValidCue, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
    xlim(-0.5, 0.5)+
  ylim(-0.3, 0.3)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "Cue")

ValidHDDPlot <- ggplot(data=ValidHDD, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
   xlim(-0.5, 0.5)+
  ylim(-0.3, 0.3)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "HDD")



AOIFixationPlot <- plot_grid(ValidControlPlot, ValidCHUDPlot, ValidCuePlot, ValidHDDPlot,ncol = 2)
AOIFixationPlot


ggsave(
    filename = "AOIFixationPlot.png",
    plot = AOIFixationPlot,
    width = 15, height = 10
  )

```

```{r}
FinalValidHazardAOIETDataRMOut <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study4Analysis/FinalValidHazardAOIETDataRMOut.csv", header = T)

ValidHazardControl <- FinalValidHazardAOIETDataRMOut %>% 
  subset(Condition == "Control")

ValidHazardHUD <- FinalValidHazardAOIETDataRMOut %>% 
  subset(Condition == "HUD")

ValidHazardCue <- FinalValidHazardAOIETDataRMOut %>% 
  subset(Condition == "Cue")

ValidHazardHDD <- FinalValidHazardAOIETDataRMOut %>% 
  subset(Condition == "HDD")


```

```{r}
ggplot(data=ValidHazardControl, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
   # xlim(-0.5, 0.5)+
  #ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "Control")

ggplot(data=ValidHazardHUD, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
   # xlim(-0.5, 0.5)+
  #ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "HUD")

ggplot(data=ValidHazardCue, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
   # xlim(-0.5, 0.5)+
  #ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "Cue")

ggplot(data=ValidHazardHDD, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
   # xlim(-0.5, 0.5)+
  #ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "HDD")

```
#Read in Hazard Clip Data
```{r}
HazardClipList <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study4Analysis/FinalStudy4HazardSheet.csv", header = T)

HazardClipList$VideoClip <- gsub("[^0-9]", "", HazardClipList$VideoClip)# remove all non-numeric characters

HazardClipList$Onset <- HazardClipList$Offset - 4000

HazardClipList$Onset <- HazardClipList$Onset / 1000

HazardClipList$Offset <- HazardClipList$Offset / 1000

HazardClipList$VideoClip <- as.numeric(HazardClipList$VideoClip)

HazardClipList <- HazardClipList[complete.cases(HazardClipList$VideoClip), ] 


HazardClipList <- HazardClipList %>% 
  select(-c(xLocationOnset, xLocationOffset, convertedxLocationOnset, convertedxLocationOffset, yLocationOnset, yLocationOffset, convertedyLocationOnset, convertedyLocationOffset))


```

```{r}
ClipTimes <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/R_Scripts/Study4Analysis/ClipTimes.csv", header = T)

HazardClipTimes <-  ClipTimes

HazardClipTimes$VideoClip <- as.numeric(gsub("[^0-9]", "", HazardClipTimes$image_file))# remove all non-numeric characters

HazardClipTimes <- HazardClipTimes[complete.cases(HazardClipTimes$ETClipStart), ] %>% 
  select(-c(X.1, X))
```

#Hazard Clips Sheet
```{r}
HazardClips <- left_join(HazardClipTimes, HazardClipList, by = "VideoClip")

HazardClips$HazardOnset <- HazardClips$ETClipStart + HazardClips$Onset

HazardClips$HazardOffset <- HazardClips$ETClipStop 

CorrectAOIs <- HazardClips %>% 
  select(VideoClip, AOILocationOffset, AOILocationOffset2)

CorrectAOIs <- CorrectAOIs[!duplicated((CorrectAOIs$VideoClip)),]


```

#TTFF
```{r}
FirstFixation <- FinalValidHazardAOIETDataRMOut %>% 
  subset(CorrAOI == 1)

#FirstFixation <- FirstFixation[!duplicated((FirstFixation$PIDCond)),]

TTFF <- left_join(FirstFixation, HazardClips, by = (c("VideoClip" = "VideoClip", "PIDCond" = "Sort")))
  
TTFF$FirstFixationTime <- TTFF$TimeStamp - TTFF$HazardOnset

TTFFSummary <- TTFF %>% 
  group_by(Condition.x, CorrAOI) %>% 
  summarise(n = n(),
            TTFF = mean(FirstFixationTime))




```

#CountData
```{r}
CountData <- FinalValidAOIETDataRMOut

CountData$Sort <- paste(CountData$PIDCond,CountData$eventIndex)
  
CountData <- CountData[!duplicated(CountData$Sort),]


CorrHazardCountData <- FinalValidHazardAOIETDataRMOut

CorrHazardCountData$Sort <-paste(FinalValidHazardAOIETDataRMOut$PIDCond, FinalValidHazardAOIETDataRMOut$eventIndex)
CorrHazardCountData <- CorrHazardCountData[!duplicated(CorrHazardCountData$Sort),]
```

#Summaries

```{r}

DurationSummary <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

ClipSummary <- CountData %>% 
  group_by(Condition, VideoClip) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

ClipSummaryAOI <- CountData %>% 
  group_by(Condition, VideoClip, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

CountSummaryAOI <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n())

AOITargetSummary <- CountData %>% 
  group_by(Condition, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T))

AOIObjectSummary <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T),
            ARFixation = sum(gazePoint_target_name != "Wall", na.rm = T),
            ScreenFixation = sum(gazePoint_target_name == "Wall" ,na.rm = T),
            ARProp = (sum(gazePoint_target_name != "Wall", na.rm = T) / n() )* 100,
            ScreenProp = (sum(gazePoint_target_name == "Wall", na.rm = T) / n() )* 100
            )

```

```{r}

PptSummaryAOI <- CountData %>% 
  group_by(PIDCond) %>% 
  summarise(NoF = sum(modified),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration))

PptSummaryAOI[c('Ppt','Condition')] <- str_split_fixed(PptSummaryAOI$PIDCond," ",2)


GroupSummary <- PptSummaryAOI %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            sumNoF = sum(NoF),
            meanNoF = mean(NoF),
            meanDuration = mean(meanDuration))
```

#Hazard Summaries
```{r}
HazardSummaryAOI <- CorrHazardCountData %>% 
  group_by(Condition, ) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

HazardClipSummaryAOI <- CorrHazardCountData %>% 
  group_by(Condition, VideoClip) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            )

HazardAOITargetSummary <- CorrHazardCountData %>%  
  group_by(Condition, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T))

HazardAOIObjectSummary <- CorrHazardCountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            fixationX = mean(fixation_x, na.rm = T),
            fixation_y = mean(fixation_y, na.rm = T),
            ARFixation = sum(gazePoint_target_name != "Wall", na.rm = T),
            ScreenFixation = sum(gazePoint_target_name == "Wall" ,na.rm = T),
            ARProp = (sum(gazePoint_target_name != "Wall", na.rm = T) / n() )* 100,
            ScreenProp = (sum(gazePoint_target_name == "Wall", na.rm = T) / n() )* 100
            )

HazardCorrSummary <- CorrHazardCountData %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            sumCorr = sum(CorrAOI),
            meanCorr = mean(CorrAOI))


```

```{r}

CorrHazardPptSummaryAOI <- CorrHazardCountData %>% 
  group_by(PIDCond) %>% 
  summarise(NoF = sum(modified),
            meanDuration = mean(eventDuration),
            sdDuration = sd(eventDuration),
            sumCorr = sum(CorrAOI),)

CorrHazardPptSummaryAOI[c('Ppt','Condition')] <- str_split_fixed(CorrHazardPptSummaryAOI$PIDCond," ",2)


CorrGroupSummary <- CorrHazardPptSummaryAOI %>% 
  group_by(Condition) %>% 
  summarise(n = n(),
            sumNoF = sum(NoF),
            sumCorrNoF = sum(sumCorr),
            meanNoF = mean(NoF),
            meanCorrNoF = mean(sumCorr),
            meanDuration = mean(meanDuration))


```



#FixCount Summaries
```{r}

FixCountSummary <- CountData %>% 
  group_by(Condition, Target = (gazePoint_target_name == "Wall")) %>% 
  summarise(n = n())%>% 
  drop_na(Target)

PivotFixCountSummary <- FixCountSummary %>% 
  pivot_wider(names_from =  "Target", values_from = n)

dataCHI <- matrix(c(6131,4590,527,3166), ncol = 1, byrow = T)
colnames(dataCHI) <- ("Screen")
rownames(dataCHI) <- c("Control", "Cue","HDD", "HUD")

dataCHI <- as.table(dataCHI)

dataCHI

FixCountSummary$Target[FixCountSummary$Target == TRUE] <- "Video"
FixCountSummary$Target[FixCountSummary$Target == FALSE] <- "AR"

FixCountSummary$Condition <- factor(FixCountSummary$Condition, ordered = FALSE)

FixCountSummaryScreen <- FixCountSummary %>% 
  subset(Target == "Video")

FixCountSummaryAR <- FixCountSummary %>% 
  subset(Target == "AR")

FixCountSummaryTotal <- CountData %>% 
  group_by(Condition) %>% 
  summarise(n = n())


```

#STATS

# Fixation Count - Stats
```{r}
library(lmerTest)
FixCountChi <- chisq.test(dataCHI)
FixCountChi$observed

FixCountChi


FixCountAnova <- aov(data = PptSummaryAOI, NoF ~ Condition)
summary(FixCountAnova)
qqnorm(sqrt(PptSummaryAOI$NoF))
TukeyHSD(FixCountAnova)

PptSummaryAOI$Condition <- factor(PptSummaryAOI$Condition, levels = c("Control", "Cue", "HUD", "HDD"))

PptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "Control")


FixCountLM <- lm(data =PptSummaryAOI, NoF ~ Condition, family = "poisson")
summary(FixCountLM)




```

#Total NoF Plot
```{r}
TotalNoFPlot <-ggplot(data = PptSummaryAOI, aes(x = Condition, y = NoF, fill = Condition))+
  geom_violin()+
  geom_boxplot(width = 0.07)+
  ylab("Mean Number of Fixations")+
  scale_fill_brewer(palette = "RdYlBu")+
  theme_classic()+
    theme(legend.position="none")


TotalNoFPlot

ggsave(filename = "TotalNoFPlot.png",
       plot = TotalNoFPlot)
       
       # ,
       # scale = 3,
       # device = png,
       # width = 3840,
       # units = "px",
       # dpi = 700)
```
#Hazard Fixation Count

```{r}

HazFixCountSummary <- CorrHazardCountData %>% 
  group_by(Condition, Target = (gazePoint_target_name == "Wall")) %>% 
  summarise(n = n(),
            NumCorr = sum(CorrAOI, na.rm = T),
            prop = (NumCorr) / n() * 100) %>% 
  drop_na(Target)

HazFixCountSummary$Target[HazFixCountSummary$Target == TRUE] <- "Video"
HazFixCountSummary$Target[HazFixCountSummary$Target == FALSE] <- "AR"

HazFixCountSummary$Condition <- factor(HazFixCountSummary$Condition, ordered = FALSE)


HazFixCountSummaryScreen <- HazFixCountSummary %>% 
  subset(Target == "Video")

HazFixCountSummaryAR <- HazFixCountSummary %>% 
  subset(Target == "AR")

TTFFSummary <- CorrHazardCountData %>% 
  group_by(Condition, PIDCond, CorrAOI) %>% 
  summarise(n = n(),
          TTFF = min(TimeStamp)) %>% 
  group_by(Condition, CorrAOI) %>% 
  summarise(n = n(),
            TTFF = mean(TTFF))

HazFixCountSummaryTotal <- CorrHazardCountData %>% 
  group_by(Condition) %>% 
  summarise(n = n())

```
#haz Fix Count Stats

```{r}
HazFixCountChi <- chisq.test(HazardSummaryAOI$n)
HazFixCountChi

NumHazFix <- aov(data = CorrHazardPptSummaryAOI, NoF ~ Condition )

summary(NumHazFix)

TukeyHSD(NumHazFix)

CorrHazardPptSummaryAOI$Condition <- as.factor(PptSummaryAOI$Condition)

CorrHazardPptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "HUD")


HazFixCountLM <- lm(data =CorrHazardPptSummaryAOI, NoF ~ Condition, family = "poisson")
summary(HazFixCountLM)




```


```{r}
CorrHazFix <- aov(data = CorrHazardPptSummaryAOI, sumCorr ~ Condition )

summary(CorrHazFix)

TukeyHSD(CorrHazFix)

PptSummaryAOI$Condition <- as.factor(PptSummaryAOI$Condition)

PptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "HUD")


FixCountLM <- lm(data =PptSummaryAOI, NoF ~ Condition, family = "poisson")
summary(FixCountLM)



```

```{r}
NumHazFixLM <- lm( NoF ~ Condition, data = CorrHazardPptSummaryAOI)
summary(NumHazFixLM)


```


```{r}
CorrHazFixCountChi <- chisq.test(HazardCorrSummary$sumCorr)

CorrHazFixCountChi

```
#Hazard NoF Plot
```{r}
ggplot(data = CorrHazardPptSummaryAOI, aes(x = Condition, y = NoF, fill = Condition))+
  geom_col()+ 
  ylab("Number of Fixations in Hazard Window")+
  scale_fill_brewer(palette = "BrBG")+
  theme_classic()+

```


```{r}

CorrHazardPptSummaryAOI$Condition <- factor(CorrHazardPptSummaryAOI$Condition, levels = c("Control", "Cue", "HUD", "HDD"))

TotalHazardNoFPlot <- ggplot(data = CorrHazardPptSummaryAOI, aes(x = Condition, y = NoF, fill = Condition))+
  geom_violin()+
  geom_boxplot(width = 0.07)+
  ylab("Mean Number of Fixations during Hazard Window")+
  scale_fill_brewer(palette = "RdYlBu")+
  theme_classic()+
   theme(legend.position="none")



TotalHazardNoFPlot

ggsave(filename = "TotalHazardNoFPlot.png",
       plot = TotalHazardNoFPlot)
       
       # ,
       # scale = 3,
       # device = png,
       # width = 3840,
       # units = "px",
       # dpi = 700)
```

#Hazard FixationCount Corr AOI Plot
```{r}
FixCountCorrScreen <- chisq.test(HazFixCountSummaryScreen$NumCorr, y = NULL)
FixCountCorrScreen

CorrHazFixLM <- lm( sumCorr ~ Condition, data = CorrHazardPptSummaryAOI)
summary(CorrHazFixLM)
```


```{r}
ggplot(data = CorrHazardPptSummaryAOI, aes(x = Condition, y = sumCorr, fill = Condition))+
  geom_col()+ 
  ylab("Number of 'Correct' Fixations")+
  scale_fill_brewer(palette = "BrBG")+
  theme_classic()

plot(HazFixCountSummaryScreen$NumCorr)

ggplot(data = CorrHazardPptSummaryAOI, aes(x = Condition, y = sumCorr, fill = Condition))+
  geom_violin()+
  geom_boxplot(width = 0.07)+
  ylab("Mean Number of Correct Fixations during Hazard Window")+
  scale_fill_brewer(palette = "BrBG")+
  theme_classic()

```
```{r}

CorrHazardPptSummaryAOI$Condition <- factor(CorrHazardPptSummaryAOI$Condition, levels = c("Control", "Cue", "HUD", "HDD"))

TotalCorrHazardNoFPlot <- ggplot(data = CorrHazardPptSummaryAOI, aes(x = Condition, y = sumCorr, fill = Condition))+
  geom_violin()+
  geom_boxplot(width = 0.07)+
  ylab("Mean Number of Correct Fixations during Hazard Window")+
  scale_fill_brewer(palette = "RdYlBu")+
  theme_classic()

TotalCorrHazardNoFPlot

ggsave(filename = "TotalCorrHazardNoFPlot.png",
       plot = TotalCorrHazardNoFPlot,
       scale = 3)
```
#CowPlot
```{r}
library(cowplot)

legend_b <- get_legend(
  TotalNoFPlot + 
    guides(color = guide_legend(nrow = 1)) +
   theme(legend.position = "bottom")
)

AllTotalNoF <- plot_grid(TotalNoFPlot, TotalHazardNoFPlot,labels = c('a)','b)'),ncol = 2)
AllTotalNoFLeg <- plot_grid(AllTotalNoF, legend_b,ncol = 1, rel_heights = c(1, .1))
AllTotalNoFLeg

ggsave(filename = "AllTotalNoFLeg.jpg",
       plot = AllTotalNoFLeg,
       width = 3840,
       units = "px")
```


```{r}

CorrHazardPptSummaryAOI$Condition <- as.factor(PptSummaryAOI$Condition)

CorrHazardPptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "HUD")


CorrHazFixCountLM <- lm(data =CorrHazardPptSummaryAOI, sumCorr ~ Condition, family = "poisson")
summary(CorrHazFixCountLM)

```


#Fixation Duration

```{r}
hist(FinalValidAOIETDataRMOut$eventDuration)

shapiro.test(FinalValidAOIETDataRMOut$eventDuration[0:5000])
#ad.hoc.test(FinalValidAOIETDataRMOut$eventDuration)

qqnorm(sqrt(FinalValidAOIETDataRMOut$eventDuration))
ggplot(FinalValidAOIETDataRMOut, aes(x = eventDuration, fill = Condition)) + geom_density(alpha = .3)
```


```{r}
hist(CountData$eventDuration)

shapiro.test(CountData$eventDuration[0:5000])
#ad.hoc.test(FinalValidAOIETDataRMOut$eventDuration)

qqnorm(sqrt(CountData$eventDuration))
ggplot(CountData, aes(x = eventDuration, fill = Condition)) + geom_density(alpha = .3)

```

```{r}
library(ggpubr)

bxp <- ggboxplot(CountData, x = "Condition", y = "eventDuration")
bxp
```

```{r}
summary(lm(eventDuration ~ Condition, data = CountData))

BasicDwellAOV <- summary(aov(eventDuration ~ Condition, data = CountData))

#BasicDwellAOVPW <- pairwise.t.test()

#DwellModel <- glmer(eventDuration ~ Condition + (1|ID), data = FinalValidAOIETDataRMOut, family = poisson)

```


```{r}
bxpRMOut <- ggboxplot(CountData, x = "Condition", y = "eventDuration")
bxpRMOut

ggplot(CountData, aes(x = Condition, y = eventDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration (ms)")+
  theme_classic()+
    scale_fill_brewer(palette = "BrBG")

```

```{r}
a1 <- aov(eventDuration ~ Condition, data = CountData)
summary(a1)

Tukeya1 <- TukeyHSD(a1)
Tukeya1

a2 <- aov(meanDuration ~ Condition, data = PptSummaryAOI)
summary(a2)

Tukeya2 <- TukeyHSD(a2)
Tukeya2

```

```{r}
ggplot(FinalValidAOIETDataRMOut, aes(x = Condition, y = eventDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration (ms)")+
  theme_classic()+
    scale_fill_brewer(palette = "BrBG")

ggplot(CountData, aes(x = Condition, y = eventDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration (ms)")+
  theme_classic()+
    scale_fill_brewer(palette = "BrBG")

ggplot(PptSummaryAOI, aes(x = Condition, y = meanDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration (ms)")+
  theme_classic()+
    scale_fill_brewer(palette = "BrBG")

```
#Fixation Duration Models

```{r}
FinalValidAOIETDataRMOut$Condition <- as.factor(FinalValidAOIETDataRMOut$Condition)

DurModelNull <- lmer(eventDuration ~ (1|ID), data = FinalValidAOIETDataRMOut)

DurModelBasic <- lmer(data = FinalValidAOIETDataRMOut, formula = eventDuration ~ Condition + (1|ID))

summary(DurModelBasic)

DurModel1 <- lmer(data = FinalValidAOIETDataRMOut,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip))
summary(DurModel1)

DurModel2 <- lmer(data = FinalValidAOIETDataRMOut,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePointAOI_name))
summary(DurModel2)

DurModel3 <- lmer(data = FinalValidAOIETDataRMOut,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePoint_target_name) + (1|gazePointAOI_name))
summary(DurModel3)

FinalValidAOIETDataRMOut$Condition <- relevel(FinalValidAOIETDataRMOut$Condition, ref = "Control")

anova(DurModelNull, DurModelBasic, DurModel1, DurModel2,DurModel3)

```

#Fix Dur Count Data
```{r}
CountData$Condition <- as.factor(CountData$Condition)

DurModelNull <- lmer(eventDuration ~ (1|ID), data = CountData)

DurModelBasic <- lmer(data = CountData, formula = eventDuration ~ Condition + (1|ID))

summary(DurModelBasic)

DurModel1 <- lmer(data = CountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip))
summary(DurModel1)

DurModel2 <- lmer(data = CountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePointAOI_name))
summary(DurModel2)

DurModel3 <- lmer(data = CountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePoint_target_name) + (1|gazePointAOI_name))
summary(DurModel3)

DurModel4 <- lmer(data = CountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePoint_target_name) + (1|gazePointAOI_name) + (1|TimeStamp))
summary(DurModel4)

CountData$Condition <- relevel(CountData$Condition, ref = "Control")

anova(DurModelNull, DurModelBasic, DurModel1, DurModel2,DurModel3, DurModel4)

```

#FixDur Ppt Mean data
```{r}
PptSummaryAOI$Condition <- as.factor(PptSummaryAOI$Condition)

DurModelNull <- lmer(meanDuration ~ (1|Ppt), data = PptSummaryAOI)

DurModelBasic <- lm(data = PptSummaryAOI, formula = meanDuration ~ Condition, family = "poisson")

#DurModelBasic <- lmer(data = PptSummaryAOI, formula = meanDuration ~ Condition + (1|Ppt))

summary(DurModelBasic)
qqnorm(sqrt(PptSummaryAOI$meanDuration))
PptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "HUD")

#anova(DurModelNull, DurModelBasic, DurModel1, DurModel2,DurModel3, DurModel4)
```

#Total Fix Dur Plot
```{r}

PptSummaryAOI$Condition <- factor(PptSummaryAOI$Condition, levels = c("Control", "Cue", "HUD", "HDD"))

TotalFixDurPlot <- ggplot(data = PptSummaryAOI, aes(x = Condition, y = meanDuration, fill = Condition))+
  geom_violin()+
  geom_boxplot(width = 0.2)+
  ylab("Mean Fixation Duration")+
  scale_fill_brewer(palette = "RdYlBu")+
  theme_classic()+
   theme(legend.position="none")

TotalFixDurPlot

ggsave(filename = "TotalFixDurPlot.jpg",
       plot = TotalFixDurPlot)
       
       # ,
       # scale = 3,
       # device = png,
       # width = 3840,
       # units = "px",
       # dpi = 700)
```


```{r}
ggplot(FinalValidHazardAOIETDataRMOut, aes(x = Condition, y = eventDuration, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.18)+
  ylab("Fixation Duration in Hazard Window")+
  theme_classic()

```
#TTFF Model

```{r}

TTFF$Condition <- TTFF$Condition.x

TTFF$Condition <- as.factor(TTFF$Condition)

TTFF$Condition <- relevel(TTFF$Condition, ref = "HDD")

TTFFANOVA <- aov(FirstFixationTime ~ Condition, data = TTFF)

summary(TTFFANOVA)

# TTFFModelNull <- lmer(FirstFixationTime ~ (1|Participant), data = TTFF)
# 
# TTFFModelBasic <- lmer(data = TTFF, formula = FirstFixationTime ~ Condition + (1|Participant))
# summary(TTFFModelBasic)
# 
# TTFFModel1 <- lmer(data = TTFF,  formula = FirstFixationTime ~ Condition + (1|Participant) + (1|VideoClip))
# summary(TTFFModel1)
# 
# TTFFModel2 <- lmer(data = TTFF,  formula = FirstFixationTime ~ Condition + (1|Participant) + (1|VideoClip) + (1|gazePointAOI_name))
# summary(TTFFModel2)
# 
# TTFFModel3 <- lmer(data = TTFF,  formula = FirstFixationTime ~ Condition + (1|Participant) + (1|VideoClip) + (1|gazePoint_target_name) + (1|gazePointAOI_name))
# summary(TTFFModel3)
# 
# anova(TTFFModelNull,TTFFModelBasic,TTFFModel1,TTFFModel2,TTFFModel3)

```

```{r}
TTFFModelBasic <- lm(data = CorrHazardCountData, formula = eventDuration ~ Condition)

#DurModelBasic <- lmer(data = PptSummaryAOI, formula = meanDuration ~ Condition + (1|Ppt))

summary(TTFFModelBasic)

PptSummaryAOI$Condition <- relevel(PptSummaryAOI$Condition, ref = "Cue")
```



```{r}
ggplot(TTFF, aes(x = Condition, y = FirstFixationTime, fill = Condition))+
  geom_violin()+ 
  geom_boxplot(alpha = 0, width = 0.15)+
  ylab("Time to First Fixation (s)")+
    scale_fill_brewer(palette = "BrBG")+

  theme_classic()
```
#HazardFixation Duration
```{r}
CorrHazardCountData$Condition <- as.factor(CorrHazardCountData$Condition)
CorrHazardCountData$Condition <- relevel(CorrHazardCountData$Condition, ref = "HUD")

HazDurModelNull <- lmer(eventDuration ~ (1|ID), data = CorrHazardCountData)

HazDurModelBasic <- lmer(data = CorrHazardCountData, formula = eventDuration ~ Condition + (1|ID))

summary(HazDurModelBasic)

# HazDurModel1 <- lmer(data = CorrHazardCountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip))
# summary(HazDurModel1)
# 
# HazDurModel2 <- lmer(data = CorrHazardCountData,  formula = eventDuration ~ Condition + (1|ID) + (1|VideoClip) + (1|gazePointAOI_name))
# summary(HazDurModel2)
# 
# HazDurModel3 <- lmer(data = CorrHazardCountData,  formula = eventDuration ~ Condition + (1|ID)  + (1|gazePointAOI_name))
# summary(HazDurModel3)

anova(HazDurModelNull, HazDurModelBasic, HazDurModel1, HazDurModel2, HazDurModel3)

```

#CountHazardFixationDuration - Ppt summary
```{r}
CorrHazardPptSummaryAOI$Condition <- as.factor(CorrHazardPptSummaryAOI$Condition)
CorrHazardPptSummaryAOI$Condition <- relevel(CorrHazardPptSummaryAOI$Condition, ref = "Cue")

HazDurModelBasic <- lm(data = CorrHazardPptSummaryAOI, formula = meanDuration ~ Condition)
summary(HazDurModelBasic)

```
#Haz Fix Dura  Plot
```{r}
CorrHazardPptSummaryAOI$Condition <- factor(CorrHazardPptSummaryAOI$Condition, levels = c("Control", "Cue", "HUD", "HDD"))

TotalHazFixDurPlot <- ggplot(data = CorrHazardPptSummaryAOI, aes(x = Condition, y = meanDuration, fill = Condition))+
  geom_violin()+
  geom_boxplot(width = 0.2)+
  ylab("Mean Fixation Duration during Hazard Window")+
  scale_fill_brewer(palette = "RdYlBu")+
  theme_classic()+
   theme(legend.position="none")

TotalHazFixDurPlot

ggsave(filename = "TotalHazFixDurPlot.jpg",
       plot = TotalHazFixDurPlot)
       
```
#cowplot2
```{r}

legend_c <- get_legend(
  TotalFixDurPlot + 
    guides(color = guide_legend(nrow = 1)) +
   theme(legend.position = "bottom")
)

AllFixDur <- plot_grid(TotalFixDurPlot, TotalHazFixDurPlot,labels = c('a)','b)'),ncol = 2)
AllFixDurLeg <- plot_grid(AllFixDur, legend_b,ncol = 1, rel_heights = c(1, .1))
AllFixDurLeg

ggsave(filename = "AllFixDurLeg.jpg",
       plot = AllFixDurLeg,
       width = 3840,
       units = "px")
```


```{r}
HazardList <- read.csv("C:/Users/thoma/OneDrive - University of Glasgow/Documents/Unity Projects/TGStudy 4/Assets/Resources/FinalStudy4HazardSheet.csv")
```

#FullAOIGraphs

```{r}
ggplot(data=AOIControlETData, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
    xlim(-0.35, 0.35)+
  ylim(-0.15, 0.35)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "Control")

ggplot(data=AOIHUDETData, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 100)+
    xlim(-0.5, 0.5)+
  ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title = "HUD")

ggplot(data=AOICueETData, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 100)+
    xlim(-0.5, 0.5)+
  ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title = "Cue")

ggplot(data=AOIHDDETData, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 100)+
    xlim(-0.5, 0.5)+
  ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title = "HDD")

```

```{r}

ggplot(data=test, aes(x=gazePoint_x, y=gazePoint_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 50)+
    xlim(-0.5, 0.5)+
  ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "Control")

ggplot(data=AOIHUDETData, aes(x=gazePoint_x, y=gazePoint_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 150)+
    xlim(-0.5, 0.5)+
  ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title = "HUD")

ggplot(data=AOICueETData, aes(x=gazePoint_x, y=gazePoint_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 150)+
    xlim(-0.5, 0.5)+
  ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title = "Cue")

ggplot(data=AOIHDDETData, aes(x=gazePoint_x, y=gazePoint_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 150)+
    xlim(-0.5, 0.5)+
  ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title = "HDD")

```

```{r}
ggplot(data=ValidAOIControlETData, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 100)+
    xlim(-0.35, 0.35)+
  ylim(-0.15, 0.35)+
    scale_fill_continuous(type = "viridis") +
  labs(title= "Control")

ggplot(data=ValidAOIHUDETData, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
stat_bin_2d(bins = 100)+
    xlim(-0.35, 0.35)+
  ylim(-0.15, 0.35)+
    scale_fill_continuous(type = "viridis")  +
  labs(title = "HUD")

ggplot(data=ValidAOICueETData, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
stat_bin_2d(bins = 100)+
    xlim(-0.35, 0.35)+
  ylim(-0.15, 0.35)+
    scale_fill_continuous(type = "viridis")  +
  labs(title = "Cue")

ggplot(data=ValidAOIHDDETData, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
stat_bin_2d(bins = 100)+
    xlim(-0.35, 0.35)+
  ylim(-0.15, 0.35)+
    scale_fill_continuous(type = "viridis") +
  labs(title = "HDD")

```
#FinalAOIGraphs
```{r}
ggplot(data=FinalValidAOIETData, aes(x=fixation_x, y=fixation_y)) +
  # geom_point()+
  # geom_bin2d()+
  stat_bin_2d(bins = 150)+
    xlim(-0.5, 0.5)+
  ylim(-0.5, 0.5)+
    scale_fill_continuous(type = "viridis") +
  labs(title = "All")

```

```{r}
AOIControlETData$TimeStamp <- AOIControlETData$TimeStamp / 100
AOIControlETData$DuringClip <- FALSE

AOIControlETData$DuringClip <- if_else(AOIControlETData$TimeStamp >= AOIControlETData$ETClipStart && AOIControlETData$TimeStamp <= AOIControlETData$ETClipStop, TRUE, FALSE)

AOIControlETData<- AOIControlETData %>% 
  select(-(AOIControlETData$DuringClip == TRUE))

AOIControlETDataClips <- subset(AOIControlETData, DuringClip)


```

```{r}
ClipTimes <- AOIControlETData %>% 
  select(PIDCond, image_file, ClipStart, ClipStop, ETClipStart,ETClipStop)

ClipTimes <- ClipTimes[!duplicated(ClipTimes$ClipStart), ]
```


```{r}
#FixationCount <- rbind(AOIControlETData, AOICueETData, AOIHDDETData, AOIHUDETData) 


ControlFixationCountSummary <- AOIControlETData %>% 
  group_by(Condition, gazePoint_target_name, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration, na.rm = T),
            sdDuration = sd(eventDuration, na.rm = T),
            minDuration = min(eventDuration, na.rm = T),
            maxDuration = max(eventDuration, na.rm = T))


CueFixationCountSummary <- AOICueETData %>% 
  group_by(Condition, gazePoint_target_name,gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration, na.rm = T),
            sdDuration = sd(eventDuration, na.rm = T),
            minDuration = min(eventDuration, na.rm = T),
            maxDuration = max(eventDuration, na.rm = T))


HUDFixationCountSummary <- AOIHUDETData %>% 
  group_by(Condition, gazePoint_target_name,gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration, na.rm = T),
            sdDuration = sd(eventDuration, na.rm = T),
            minDuration = min(eventDuration, na.rm = T),
            maxDuration = max(eventDuration, na.rm = T))

HDDFixationCountSummary <- AOIHDDETData %>% 
  group_by(Condition, gazePoint_target_name,gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration, na.rm = T),
            sdDuration = sd(eventDuration, na.rm = T),
            minDuration = min(eventDuration, na.rm = T),
            maxDuration = max(eventDuration, na.rm = T))

```


```{r}
#FixationDuration <- rbind(AOIControlETData, AOICueETData, AOIHDDETData, AOIHUDETData) 
ControlFixationDurationSummary <- AOIControlETData %>% 
  group_by(Condition, gazePoint_target_name, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration, na.rm = T),
            sdDuration = sd(eventDuration, na.rm = T),
            minDuration = min(eventDuration, na.rm = T),
            maxDuration = max(eventDuration, na.rm = T))

CueFixationDurationSummary <- AOICueETData %>% 
  group_by(Condition, gazePoint_target_name, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration, na.rm = T),
            sdDuration = sd(eventDuration, na.rm = T),
            minDuration = min(eventDuration, na.rm = T),
            maxDuration = max(eventDuration, na.rm = T))



HUDFixationDurationSummary <- AOIHUDETData %>% 
  group_by(Condition, gazePoint_target_name, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration, na.rm = T),
            sdDuration = sd(eventDuration, na.rm = T),
            minDuration = min(eventDuration, na.rm = T),
            maxDuration = max(eventDuration, na.rm = T))

HDDFixationDurationSummary <- AOIHDDETData %>% 
  group_by(Condition, gazePoint_target_name, gazePointAOI_name) %>% 
  summarise(n = n(),
            meanDuration = mean(eventDuration, na.rm = T),
            sdDuration = sd(eventDuration, na.rm = T),
            minDuration = min(eventDuration, na.rm = T),
            maxDuration = max(eventDuration, na.rm = T))




```
